<!--
 ! Licensed to the Apache Software Foundation (ASF) under one
 ! or more contributor license agreements.  See the NOTICE file
 ! distributed with this work for additional information
 ! regarding copyright ownership. The ASF licenses this file
 ! to you under the Apache License, Version 2.0 (the
 ! "License"); you may not use this file except in compliance
 ! with the License. You may obtain a copy of the License at
 ! 
 !      http://www.apache.org/licenses/LICENSE-2.0
 ! 
 ! Unless required by applicable law or agreed to in writing, software
 ! distributed under the License is distributed on an "AS IS" BASIS,
 ! WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ! See the License for the specific language governing permissions and
 ! limitations under the License.
 !-->
<html>
<body>

This binary test kit is designed to test the Jini(TM) technology-enabled
components and services supplied in the Jini Technology Starter Kit (starter kit).
All of these tests run in the Jini Test Harness V3 (harness). This kit
is identical to that used for production testing by the Jini Technology Group.
This document assumes familiarity with the documentation supplied with the
test harness kit.

<h2>Installation Directory</h2>

This kit may be installed in a user selected directory. Installation parameters
are provided in a deployment properties file which is named on the command line
used to run the harness. The directory containing the test kit is identified in
this file by the property <code>org.apache.river.test.home</code>.  In property
files and in this document this directory will be referred to symbolically as
<code>${org.apache.river.test.home}</code>.


<h2>Deployment Properties File</h2>

When the harness is invoked from the command line, the name of a user-supplied
deployment properties file must be provided. The example prototype for this file
is located in
<code>${org.apache.river.test.home}/org/apache/river/test/resources/qaHarness.prop.</code>.
That file is derived from the <code>basicDeployment.prop</code> file that is
included in the harness source kit, and provides additional definitions specific
to this test suite, including the installation directory property described
above.

<h2>Test Logging</h2>

The tests in this test suite extend the harness test class
org.apache.river.qa.harness.QATest.  As a result, test output is generated by calls
to the Java logging API to the logger supplied by that class, having the name
<code>org.apache.river.qa.harness.</code>

<h2>Running a Test</h2>

To run the harness, at least two JAR files must be included in the classpath:

<pre>
        ${qa.home}/lib/jiniharness.jar
</pre>

is the JAR file containing the harness code and resources, and

<pre>
        ${jsk.home}/lib/jsk-platform.jar
</pre>

is the starter kit platform that is typically included in the classpath of 
Jini clients and services.

<p>

The user must specify the name of a deployment properties file on the command
line as described above. The user must also specify the name of the primary test
suite JAR file via the command-line option <code>-testJar
${org.apache.river.test.home}/lib/jinitests.jar</code>. In the following examples,
assume that the test binary kit is installed in <code>/files/jiniqa2_1_tests</code>,
the starter kit has been installed in <code>/files/jini2_1</code>, and the
harness binary kit has been installed in <code>/files/jiniqa2_1_harness</code>.  Also
assume that <code>/tmp/myharness.prop </code> is an edited version of
/files/jiniqa2_1_tests/src/org/apache/river/test/resources/qaHarness.prop, modified
to reflect the correct installation environment.

<p>

To specify a set of test categories to run, use the <code>-categories</code>
option, for example:

<pre>
  java -cp /files/jiniqa2_1_harness/lib/jiniharness.jar:/files/jini2_1/lib/jsk-platform.jar \
       org.apache.river.qa.harness.QARunner \
       /tmp/myharness.prop \
       -testJar /files/jiniqa2_1_tests/lib/jinitests.jar \
       -categories joinmanager,javaspace
</pre>

This would limit test execution to those tests whose test descriptions included
either <code>joinmanager</code> or <code>javaspace</code> in their definitions
of <code>testCategories</code>. The configuration used would be
<code>none</code> unless the value of <code>org.apache.river.harness.configs</code>
had been modified in /tmp/myharness.prop.

<p>

To specify an explicit list of tests to execute, list them after
the <code>-tests</code> option. For example,

<pre>
  java -cp /files/jiniqa2_1_harness0/lib/jiniharness.jar:/files/jini2_1/lib/jsk-platform.jar \
       org.apache.river.qa.harness.QARunner \
       /tmp/myHarness.prop \
       -testJar /files/jiniqa2_1_tests/lib/jinitests.jar \
       -tests org/apache/river/test/spec/joinmanager/EqualsTest
</pre>

This would execute only the joinmanger <code>EqualsTest</code> test. The
following command line would
run this test using the jeri ConfigurationFileSet:

<pre>
  java -cp /files/jiniqa2_1_harness0/lib/jiniharness.jar:/files/jini2_1/lib/jsk-platform.jar \
       org.apache.river.qa.harness.QARunner \
       /tmp/myHarness.prop \
       -testJar /files/jiniqa2_1_tests/lib/jinitests.jar \
       -tests org/apache/river/test/spec/joinmanager/EqualsTest \
       -org.apache.river.qa.harness.configs jeri
</pre>

The <code>-tests</code> argument is optional, and if present must be followed by
a comma-separated list of test description file names specified 
relative to the root of the primary test suite JAR file. This identifies the set of
tests to place in the run list, which may be additionally filtered by
category. If omitted, all tests are placed in the run list.

<p>

The <code>-categories</code> argument is optional, and if present must be
followed by a comma-separated list of test categories. When the run list is
processed, tests which do not belong to one of the specified categories are
discarded from the list. If omitted no category filtering is done.

<p>
One or both of these options must be specified.

<h2>Supporting Kerberos Configurations</a></h2>

The harness includes configuration files that support testing with
kerberos as the underlying security infrastructure. However, in order to run
with kerberos some additional setup is required.

<p> 

1. In order to run the Kerberos harness configuration, you need a Kerberos KDC
(Key Distribution Center) available in your network.

<p> 

2. You also need to create principals for reggie, mahalo, outrigger, mercury,
norm, phoenix, an executing test (this is a single principal used for all
tests), fiddler, an activation group (again a single principal used for all
activation groups), a server principal, and a client principal.  Refer to your
KDC documentation for instructions on how to create principals for that
particular KDC.
<p> 

3. Once the principals needed by the harness have been created, generate an
aggregate password file containing the passwords for all the principals created
in step 2 and store this password file in a location that is accessible to the
harness.  Refer to your KDC documentation for instructions on how to create
password files for your KDC.

<p> 

4. Edit the following section in the deployment properties file derived from
<code>${org.apache.river.test.home}/org/apache/river/test/resources/qaHarness.prop:</code>

<pre>
#
# The following properties are used to specify the kerberos
# environment for tests that need to access a kdc and kerberos principals
#
org.apache.river.qa.harness.kerberos.realm=[add the realm that your KDC is serving]
org.apache.river.qa.harness.kerberos.kdc=[add the name of your KDC host]
org.apache.river.qa.harness.kerberos.clientPasswordFile=[add the location for the password file created in step 3]
org.apache.river.qa.harness.kerberos.serverPasswordFile=[add the location for the password file created in step 3]
org.apache.river.qa.harness.kerberos.aggregatePasswordFile=[add the location for the password file created in step 3]
org.apache.river.qa.harness.kerberos.clientPrincipal=[add the name of the client principal created in step 2]
org.apache.river.qa.harness.kerberos.serverPrincipal=[add the name of the client principal created in step 2]
org.apache.river.qa.harness.kerberos.reggiePrincipal=[add the name of the reggie principal created in step 2]
org.apache.river.qa.harness.kerberos.mahaloPrincipal=[add the name of the mahalo principal created in step 2]
org.apache.river.qa.harness.kerberos.outriggerPrincipal=[add the name of the outrigger principal created in step 2]
org.apache.river.qa.harness.kerberos.mercuryPrincipal=[add the name of the mercury principal created in step 2]
org.apache.river.qa.harness.kerberos.normPrincipal=[add the name of the norm principal created in step 2]
org.apache.river.qa.harness.kerberos.phoenixPrincipal=[add the name of the phoenix principal created in step 2]
org.apache.river.qa.harness.kerberos.testPrincipal=[add the name of the test principal created in step 2]
org.apache.river.qa.harness.kerberos.fiddlerPrincipal=[add the name of the fiddler principal created in step 2]
org.apache.river.qa.harness.kerberos.groupPrincipal=[add the name of the group principal created in step 2]
</pre>

<p>

5. If you wish to run the End2End Security Test, you must also edit
<code>${org.apache.river.test.home}/org/apache/river/test/impl/e2etest/End2EndTestKerberos.td</code> and
provide a value for the <code>org.apache.river.test.impl.end2end.kinit</code>
property.  The value for this property should be the command that generates
forwardable tickets stored in the local ticket cache for your KDC.
</body>
</html>
