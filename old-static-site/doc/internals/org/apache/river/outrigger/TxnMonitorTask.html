<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_60) on Mon Mar 28 17:11:50 AEST 2016 -->
<title>TxnMonitorTask (River-Internet vtrunk API Documentation (internals))</title>
<meta name="date" content="2016-03-28">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="TxnMonitorTask (River-Internet vtrunk API Documentation (internals))";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TxnMonitorTask.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/river/outrigger/TxnMonitor.ToMonitor.html" title="class in org.apache.river.outrigger"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../org/apache/river/outrigger/TxnState.html" title="class in org.apache.river.outrigger"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/river/outrigger/TxnMonitorTask.html" target="_top">Frames</a></li>
<li><a href="TxnMonitorTask.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.river.outrigger</div>
<h2 title="Class TxnMonitorTask" class="title">Class TxnMonitorTask</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li><a href="../../../../org/apache/river/thread/RetryTask.html" title="class in org.apache.river.thread">org.apache.river.thread.RetryTask</a></li>
<li>
<ul class="inheritance">
<li>org.apache.river.outrigger.TxnMonitorTask</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.Future.html?is-external=true" title="class or interface in java.util">java.util.concurrent.Future</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.RunnableFuture.html?is-external=true" title="class or interface in java.util">java.util.concurrent.RunnableFuture</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html" title="interface in net.jini.core.transaction.server">TransactionConstants</a>, <a href="../../../../org/apache/river/constants/TimeConstants.html" title="interface in org.apache.river.constants">TimeConstants</a>, <a href="../../../../org/apache/river/thread/FutureObserver.ObservableFuture.html" title="interface in org.apache.river.thread">FutureObserver.ObservableFuture</a></dd>
</dl>
<hr>
<br>
<pre>class <span class="typeNameLabel">TxnMonitorTask</span>
extends <a href="../../../../org/apache/river/thread/RetryTask.html" title="class in org.apache.river.thread">RetryTask</a>
implements <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html" title="interface in net.jini.core.transaction.server">TransactionConstants</a>, <a href="../../../../org/apache/river/constants/TimeConstants.html" title="interface in org.apache.river.constants">TimeConstants</a></pre>
<div class="block">A task that will try to validate the state of a transaction.  This
 uses weak references a good deal to let the other parts of the system
 be GC'ed as necessary.
 <p>
 The retry mechanism is subtle, so bear with me.  The purpose is
 to ensure that if any activity is being blocked by a given
 transaction, that transaction will be tested at some point in
 the future (if necessary, i.e., if it still is thought to be
 active).  We assume it to be rare that a transactions that the
 space thinks is active is, in fact, aborted, so the algorithm is
 designed to guarantee the detection without a lot of overhead,
 specifically without a lot of RMI calls.
 <p>
 Each task has three values: a <code>nextQuery</code> time, a
 <code>mustQuery</code> boolean that force the next query to be
 made, and <code>deltaT</code>, the time at which the following
 query will be scheduled.  When the task is awakened at its
 <code>nextQuery</code> time, it checks to see if it must make an
 actual query to the transaction manager, which it will do if either
 <code>mustQuery</code> is <code>true</code>, or if we know about
 any in progress queries on the space that are blocked on the
 transaction.  Whether or not an actual query is made,
 <code>deltaT</code> is added to <code>nextQuery</code> to get the
 <code>nextQuery</code> time, <code>deltaT</code> is doubled, and
 <code>mustQuery</code> boolean is set to <code>false</code>.
 <p>
 There are two kinds of requests that a with which transaction
 can cause a conflict -- those with long timeouts (such as
 blocking reads and takes) and those that are under short timeouts
 (such as reads and takes with zero-length timeouts).  We will
 treat them separately at several points of the algorithm.  A
 short timeout is any query whose expiration time is sooner than
 the <code>nextQuery</code> time.  Any other timeout is long
 If a short query arrives, <code>mustQuery</code> is set to 
 <code>true</code>.
 <p>
 The result is that any time a transaction causes a conflict, if
 the query on the space has not ended by the time of the
 <code>nextQuery</code> we will attempt to poll the transaction manager.  
 There will also poll the transaction manager if any conflict occurred
 on a query on the space with a short timeout.
 <p>
 The first time a transaction causes a conflict, we schedule a
 time in the future at which we will poll its status.  We do not
 poll right away because often a transaction will complete on
 its own before we get to that time, making the check
 unnecessary.  An instant poll is, therefore, unnecessarily
 aggressive, since giving an initial grace time will usually mean
 no poll is made at all.  So if the first conflict occurs at
 <i>T</i><sub>0</sub>, the <code>nextQuery</code> value will be
 <i>T</i><sub>0</sub><code>+INITIAL_GRACE</code>, the boolean
 will be <code>true</code> to force that poll to happen, and
 <code>deltaT</code> will be set to <code>INITIAL_GRACE</code>.</div>
<dl>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>Sun Microsystems, Inc.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../org/apache/river/outrigger/TxnMonitor.html" title="class in org.apache.river.outrigger"><code>TxnMonitor</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#BETWEEN_EXCEPTIONS">BETWEEN_EXCEPTIONS</a></span></code>
<div class="block">The retry time when we have an encountered an exception</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#deltaT">deltaT</a></span></code>
<div class="block">next value added to <code>nextQuery</code></div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.atomic.AtomicInteger.html?is-external=true" title="class or interface in java.util">java.util.concurrent.atomic.AtomicInteger</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#failCnt">failCnt</a></span></code>
<div class="block">count of RemoteExceptions</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#INITIAL_GRACE">INITIAL_GRACE</a></span></code>
<div class="block">The initial grace period before the first query.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static <a href="http://docs.oracle.com/javase/8/docs/api/java/util/logging/Logger.html?is-external=true" title="class or interface in java.util.logging">Logger</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#logger">logger</a></span></code>
<div class="block">Logger for logging transaction related information</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#MAX_DELTA_T">MAX_DELTA_T</a></span></code>
<div class="block">The largest value that <code>deltaT</code> will reach.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#MAX_FAILURES">MAX_FAILURES</a></span></code>
<div class="block">The maximum number of failures allowed in a row before we simply
 give up on the transaction and consider it aborted.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../org/apache/river/outrigger/TxnMonitor.html" title="class in org.apache.river.outrigger">TxnMonitor</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#monitor">monitor</a></span></code>
<div class="block">the monitor we were made by</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#mustQuery">mustQuery</a></span></code>
<div class="block">When we're given an opportunity to poll the transaction manager
 for the <code>txn</code>'s state, do so.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.atomic.AtomicLong.html?is-external=true" title="class or interface in java.util">java.util.concurrent.atomic.AtomicLong</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#nextQuery">nextQuery</a></span></code>
<div class="block">The next time we need to poll the transaction manager 
 to get <code>txn</code>'s actual state.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="http://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="../../../../org/apache/river/outrigger/QueryWatcher.html" title="class in org.apache.river.outrigger">QueryWatcher</a>,<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Collection.html?is-external=true" title="class or interface in java.util">Collection</a>&lt;<a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a>&gt;&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#queries">queries</a></span></code>
<div class="block">All the queries on the space (not queries to the transaction
 manager) waiting for <code>txn</code> to be resolved.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private <a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#txn">txn</a></span></code>
<div class="block">transaction being monitored</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.net.jini.core.transaction.server.TransactionConstants">
<!--   -->
</a>
<h3>Fields inherited from interface&nbsp;net.jini.core.transaction.server.<a href="../../../../net/jini/core/transaction/server/TransactionConstants.html" title="interface in net.jini.core.transaction.server">TransactionConstants</a></h3>
<code><a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#ABORTED">ABORTED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#ACTIVE">ACTIVE</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#COMMITTED">COMMITTED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#NOTCHANGED">NOTCHANGED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#PREPARED">PREPARED</a>, <a href="../../../../net/jini/core/transaction/server/TransactionConstants.html#VOTING">VOTING</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="fields.inherited.from.class.org.apache.river.constants.TimeConstants">
<!--   -->
</a>
<h3>Fields inherited from interface&nbsp;org.apache.river.constants.<a href="../../../../org/apache/river/constants/TimeConstants.html" title="interface in org.apache.river.constants">TimeConstants</a></h3>
<code><a href="../../../../org/apache/river/constants/TimeConstants.html#DAYS">DAYS</a>, <a href="../../../../org/apache/river/constants/TimeConstants.html#HOURS">HOURS</a>, <a href="../../../../org/apache/river/constants/TimeConstants.html#MINUTES">MINUTES</a>, <a href="../../../../org/apache/river/constants/TimeConstants.html#SECONDS">SECONDS</a></code></li>
</ul>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#TxnMonitorTask-org.apache.river.outrigger.Txn-org.apache.river.outrigger.TxnMonitor-java.util.concurrent.ExecutorService-org.apache.river.thread.WakeupManager-">TxnMonitorTask</a></span>(<a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a>&nbsp;txn,
              <a href="../../../../org/apache/river/outrigger/TxnMonitor.html" title="class in org.apache.river.outrigger">TxnMonitor</a>&nbsp;monitor,
              <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.ExecutorService.html?is-external=true" title="class or interface in java.util">java.util.concurrent.ExecutorService</a>&nbsp;manager,
              <a href="../../../../org/apache/river/thread/WakeupManager.html" title="class in org.apache.river.thread">WakeupManager</a>&nbsp;wakeupMgr)</code>
<div class="block">Create a new TxnMonitorTask.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#add-org.apache.river.outrigger.QueryWatcher-">add</a></span>(<a href="../../../../org/apache/river/outrigger/QueryWatcher.html" title="class in org.apache.river.outrigger">QueryWatcher</a>&nbsp;query)</code>
<div class="block">Add in a resource.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>(package private) void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#addSibling-org.apache.river.outrigger.Txn-">addSibling</a></span>(<a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a>&nbsp;txn)</code>
<div class="block">Add a ``sibling'' transaction, one that is now blocking progress
 on one of the same entries.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#logUnpackingFailure-java.lang.String-java.util.logging.Level-boolean-java.lang.Throwable-">logUnpackingFailure</a></span>(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;exceptionDescription,
                   <a href="http://docs.oracle.com/javase/8/docs/api/java/util/logging/Level.html?is-external=true" title="class or interface in java.util.logging">Level</a>&nbsp;level,
                   boolean&nbsp;terminal,
                   <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a>&nbsp;t)</code>
<div class="block">Log failed unpacking attempt attempt</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#retryTime--">retryTime</a></span>()</code>
<div class="block">Return the time of the next query, bumping <code>deltaT</code> as
 necessary for the next iteration.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/river/outrigger/TxnMonitorTask.html#tryOnce--">tryOnce</a></span>()</code>
<div class="block">Try to see if this transaction should be aborted.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.org.apache.river.thread.RetryTask">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;org.apache.river.thread.<a href="../../../../org/apache/river/thread/RetryTask.html" title="class in org.apache.river.thread">RetryTask</a></h3>
<code><a href="../../../../org/apache/river/thread/RetryTask.html#addObserver-org.apache.river.thread.FutureObserver-">addObserver</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#attempt--">attempt</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#cancel-boolean-">cancel</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#get--">get</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#get-long-java.util.concurrent.TimeUnit-">get</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#isCancelled--">isCancelled</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#isDone--">isDone</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#run--">run</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#startTime--">startTime</a>, <a href="../../../../org/apache/river/thread/RetryTask.html#waitFor-long-">waitFor</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#clone--" title="class or interface in java.lang">clone</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#finalize--" title="class or interface in java.lang">finalize</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="txn">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>txn</h4>
<pre>private final&nbsp;<a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a> txn</pre>
<div class="block">transaction being monitored</div>
</li>
</ul>
<a name="monitor">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>monitor</h4>
<pre>private final&nbsp;<a href="../../../../org/apache/river/outrigger/TxnMonitor.html" title="class in org.apache.river.outrigger">TxnMonitor</a> monitor</pre>
<div class="block">the monitor we were made by</div>
</li>
</ul>
<a name="queries">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>queries</h4>
<pre>private&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Map.html?is-external=true" title="class or interface in java.util">Map</a>&lt;<a href="../../../../org/apache/river/outrigger/QueryWatcher.html" title="class in org.apache.river.outrigger">QueryWatcher</a>,<a href="http://docs.oracle.com/javase/8/docs/api/java/util/Collection.html?is-external=true" title="class or interface in java.util">Collection</a>&lt;<a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a>&gt;&gt; queries</pre>
<div class="block">All the queries on the space (not queries to the transaction
 manager) waiting for <code>txn</code> to be resolved.
 <code>null</code> until we have at least one. Represented by
 <code>QueryWatcher</code> objects.</div>
</li>
</ul>
<a name="failCnt">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>failCnt</h4>
<pre>private final&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.atomic.AtomicInteger.html?is-external=true" title="class or interface in java.util">java.util.concurrent.atomic.AtomicInteger</a> failCnt</pre>
<div class="block">count of RemoteExceptions</div>
</li>
</ul>
<a name="nextQuery">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>nextQuery</h4>
<pre>private final&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.atomic.AtomicLong.html?is-external=true" title="class or interface in java.util">java.util.concurrent.atomic.AtomicLong</a> nextQuery</pre>
<div class="block">The next time we need to poll the transaction manager 
 to get <code>txn</code>'s actual state.</div>
</li>
</ul>
<a name="mustQuery">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mustQuery</h4>
<pre>private volatile&nbsp;boolean mustQuery</pre>
<div class="block">When we're given an opportunity to poll the transaction manager
 for the <code>txn</code>'s state, do so.</div>
</li>
</ul>
<a name="deltaT">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deltaT</h4>
<pre>private volatile&nbsp;long deltaT</pre>
<div class="block">next value added to <code>nextQuery</code></div>
</li>
</ul>
<a name="INITIAL_GRACE">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>INITIAL_GRACE</h4>
<pre>private static final&nbsp;long INITIAL_GRACE</pre>
<div class="block">The initial grace period before the first query.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../constant-values.html#org.apache.river.outrigger.TxnMonitorTask.INITIAL_GRACE">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="BETWEEN_EXCEPTIONS">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>BETWEEN_EXCEPTIONS</h4>
<pre>private static final&nbsp;long BETWEEN_EXCEPTIONS</pre>
<div class="block">The retry time when we have an encountered an exception</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../constant-values.html#org.apache.river.outrigger.TxnMonitorTask.BETWEEN_EXCEPTIONS">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="MAX_DELTA_T">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MAX_DELTA_T</h4>
<pre>private static final&nbsp;long MAX_DELTA_T</pre>
<div class="block">The largest value that <code>deltaT</code> will reach.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../constant-values.html#org.apache.river.outrigger.TxnMonitorTask.MAX_DELTA_T">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="MAX_FAILURES">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>MAX_FAILURES</h4>
<pre>private static final&nbsp;int MAX_FAILURES</pre>
<div class="block">The maximum number of failures allowed in a row before we simply
 give up on the transaction and consider it aborted.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../constant-values.html#org.apache.river.outrigger.TxnMonitorTask.MAX_FAILURES">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="logger">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>logger</h4>
<pre>private static final&nbsp;<a href="http://docs.oracle.com/javase/8/docs/api/java/util/logging/Logger.html?is-external=true" title="class or interface in java.util.logging">Logger</a> logger</pre>
<div class="block">Logger for logging transaction related information</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="TxnMonitorTask-org.apache.river.outrigger.Txn-org.apache.river.outrigger.TxnMonitor-java.util.concurrent.ExecutorService-org.apache.river.thread.WakeupManager-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TxnMonitorTask</h4>
<pre>TxnMonitorTask(<a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a>&nbsp;txn,
               <a href="../../../../org/apache/river/outrigger/TxnMonitor.html" title="class in org.apache.river.outrigger">TxnMonitor</a>&nbsp;monitor,
               <a href="http://docs.oracle.com/javase/8/docs/api/java/util/concurrent.ExecutorService.html?is-external=true" title="class or interface in java.util">java.util.concurrent.ExecutorService</a>&nbsp;manager,
               <a href="../../../../org/apache/river/thread/WakeupManager.html" title="class in org.apache.river.thread">WakeupManager</a>&nbsp;wakeupMgr)</pre>
<div class="block">Create a new TxnMonitorTask.</div>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="retryTime--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>retryTime</h4>
<pre>public&nbsp;long&nbsp;retryTime()</pre>
<div class="block">Return the time of the next query, bumping <code>deltaT</code> as
 necessary for the next iteration.  If the transaction has voted
 <code>PREPARED</code> or the manager has been giving us a
 <code>RemoteException</code>, we should retry on short times;
 otherwise we back off quickly.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Overrides:</span></dt>
<dd><code><a href="../../../../org/apache/river/thread/RetryTask.html#retryTime--">retryTime</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/apache/river/thread/RetryTask.html" title="class in org.apache.river.thread">RetryTask</a></code></dd>
</dl>
</li>
</ul>
<a name="addSibling-org.apache.river.outrigger.Txn-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addSibling</h4>
<pre>void&nbsp;addSibling(<a href="../../../../org/apache/river/outrigger/Txn.html" title="class in org.apache.river.outrigger">Txn</a>&nbsp;txn)</pre>
<div class="block">Add a ``sibling'' transaction, one that is now blocking progress
 on one of the same entries.  For example, if a client is blocked
 on a <code>read</code>, another transaction can read the same
 entry, thereby also blocking that same client.  This means that
 the transaction for the second <code>read</code> must be
 watched, too.  The list of queries for the second transaction
 might be less that the list of those in this transaction, but
 the process of figuring out the subset is too expensive, since
 we have tried to make the checking process itself cheap,
 anyway.  So we add all queries this task is currently monitoring
 to the task monitoring the second transaction.  If there are
 no queries, then the blocking occurred because of a short query
 or all the queries have expired, in which case the second transaction
 isn't blocking the way of anything currently, so this method does
 nothing.
 <p>
 Of course, in order to avoid blocking the thread that is calling
 this (which is trying to perform a <code>read</code>, after
 all), we simply add each lease in this task to the monitor's
 queue.</div>
</li>
</ul>
<a name="tryOnce--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>tryOnce</h4>
<pre>public&nbsp;boolean&nbsp;tryOnce()</pre>
<div class="block">Try to see if this transaction should be aborted.  This returns
 <code>true</code> (don't repeat the task) if it knows that the
 transaction is no longer interesting to anyone.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="../../../../org/apache/river/thread/RetryTask.html#tryOnce--">tryOnce</a></code>&nbsp;in class&nbsp;<code><a href="../../../../org/apache/river/thread/RetryTask.html" title="class in org.apache.river.thread">RetryTask</a></code></dd>
</dl>
</li>
</ul>
<a name="add-org.apache.river.outrigger.QueryWatcher-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>add</h4>
<pre>void&nbsp;add(<a href="../../../../org/apache/river/outrigger/QueryWatcher.html" title="class in org.apache.river.outrigger">QueryWatcher</a>&nbsp;query)</pre>
<div class="block">Add in a resource.  The lease may already be in, in which case it is
 ignored, or it may be null, in which case it was a non-leased probe
 that was blocked and we simply set <code>mustQuery</code> to
 <code>true</code>.</div>
</li>
</ul>
<a name="logUnpackingFailure-java.lang.String-java.util.logging.Level-boolean-java.lang.Throwable-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>logUnpackingFailure</h4>
<pre>private&nbsp;void&nbsp;logUnpackingFailure(<a href="http://docs.oracle.com/javase/8/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</a>&nbsp;exceptionDescription,
                                 <a href="http://docs.oracle.com/javase/8/docs/api/java/util/logging/Level.html?is-external=true" title="class or interface in java.util.logging">Level</a>&nbsp;level,
                                 boolean&nbsp;terminal,
                                 <a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</a>&nbsp;t)</pre>
<div class="block">Log failed unpacking attempt attempt</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/TxnMonitorTask.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/river/outrigger/TxnMonitor.ToMonitor.html" title="class in org.apache.river.outrigger"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../org/apache/river/outrigger/TxnState.html" title="class in org.apache.river.outrigger"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/river/outrigger/TxnMonitorTask.html" target="_top">Frames</a></li>
<li><a href="TxnMonitorTask.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright 2007-2013, multiple authors.<br>Licensed under the <a href=http://www.apache.org/licenses/LICENSE-2.0 target=child >Apache License, Version 2.0</a>, see the <a href=../../../../doc-files/NOTICE target=child >NOTICE</a> file for attributions.</small></p>
</body>
</html>
