<!--
 ! Licensed to the Apache Software Foundation (ASF) under one
 ! or more contributor license agreements.  See the NOTICE file
 ! distributed with this work for additional information
 ! regarding copyright ownership. The ASF licenses this file
 ! to you under the Apache License, Version 2.0 (the
 ! "License"); you may not use this file except in compliance
 ! with the License. You may obtain a copy of the License at
 ! 
 !      http://www.apache.org/licenses/LICENSE-2.0
 ! 
 ! Unless required by applicable law or agreed to in writing, software
 ! distributed under the License is distributed on an "AS IS" BASIS,
 ! WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ! See the License for the specific language governing permissions and
 ! limitations under the License.
 !-->

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="GENERATOR" content="Quadralay WebWorks Publisher 5.0.4">
<link rel="StyleSheet" href="standard.css" type="text/css" media="screen">
<title>Jini Discovery & Join Specification</title>
</head>
<body bgcolor="#ffffff">
<a href="#skip" title="Skip navigation bar"></a>
<table width="90%">
<tr>
<td align=left><a href="../../spec-index.html">Spec Index</a></td>
<td align=right><em>Jini Technology Core Platform Specifications</em></td>
</tr>
</table>
<a name="skip"></a>
<br clear="all">


<hr align="left">
<table width="90%">
<tr>
<td align="right" font size="4"><b>Version 3.0</b></td>
</tr>
</table>

<blockquote>
<h2 align="left">
<a name="40553"></a>
  <a name="999930"> </a>DJ - Jini<font size="-1"><sup>TM</sup></font> Discovery & Join Specification	 
</h2>
<h3 class="Heading2">
  <a name="18973"> </a>DJ.1	 Introduction
</h3>
<p class="Body">
  <a name="2506"> </a>Entities that wish to start participating in a distributed system of Jini<font size="-1"><sup>TM</sup></font> technology-enabled services and/or devices, known as a <em class="Emphasis">djinn</em>, must first obtain references to one or more Jini lookup services. The protocols that govern the acquisition of these references are known as the <em class="Emphasis">discovery</em> protocols. Once these references have been obtained, a number of steps must be taken for entities to start communicating usefully with services in a djinn; these steps are described by the <em class="Emphasis">join</em> protocol.
</p>
<h4 class="Heading3">
  <a name="2830"> </a>DJ.1.1	 Terminology
</h4>
<p class="Body">
  <a name="2831"> </a>A <em class="Emphasis">host</em> is a single hardware device that may be connected to one or more networks. An individual host may house one or more Java<font size="-1"><sup>TM</sup></font> virtual machines<a href="#41119"><sup>1</sup></a> (<span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">JVM</span>).
</p>
<p class="Body">
  <a name="3843"> </a>Throughout this document we make reference to a <em class="Emphasis">discovering entity</em>, a <em class="Emphasis">joining entity,</em> or simply an <em class="Emphasis">entity</em>.
</p>
<ul>

  <li class="SmartList1"><a name="3844"> </a>A <em class="Emphasis">discovering entity</em> is simply one or more cooperating objects in the Java programming language on the same host that are about to start, or are in the process of, obtaining references to Jini lookup services. 
  <li class="SmartList1"><a name="2834"> </a>A <em class="Emphasis">joining entity</em> comprises one or more cooperating objects in the Java programming language on the same host that have just received a reference to the lookup service and are in the process of obtaining services from, and possibly exporting them to, a djinn. 
  <li class="SmartList1"><a name="2835"> </a>An <em class="Emphasis">entity</em> may be a discovering entity, a joining entity, or an entity that is already a member of a djinn; the intended meaning should be clear from the context.
  <li class="SmartList1"><a name="3796"> </a>A <em class="Emphasis">group</em> is a logical name by which a djinn is identified.
</ul>

<p class="Body">
  <a name="2836"> </a>Since all participants in a djinn are collections of one or more objects in the Java programming language, this document will not make a distinction between an entity that is a dedicated device using Jini technology or something running in a <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">JVM</span> that is hosted on a legacy system. Such distinctions will be made only when necessary.
</p>
<h4 class="Heading3">
  <a name="2670"> </a>DJ.1.2	 Host Requirements
</h4>
<p class="Body">
  <a name="2671"> </a>Hosts that wish to participate in a djinn must have the following properties:
</p>
<ul>

  <li class="SmartList1"><a name="2672"> </a>A functioning <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">JVM</span>, with access to all packages needed to run software written to the Jini specifications
  <li class="SmartList1"><a name="2735"> </a>A properly configured network protocol stack
</ul>

<p class="Body">
  <a name="2736"> </a>The properties required of the network protocol stack will vary depending on the network protocol(s) being used. Throughout this document we will assume that IP is being used, and highlight areas that might apply differently to other networking protocols.
</p>
<h5 class="Heading4">
  <a name="2737"> </a>DJ.1.2.1	 Protocol Stack Requirements for IP Networks
</h5>
<p class="Body">
  <a name="2738"> </a>Hosts that make use of IP for networking must have the following properties:
</p>
<ul>

  <li class="SmartList1"><a name="2741"> </a>An IP address. IP addresses may be statically assigned to some hosts, but we expect that many hosts will have addresses assigned to them dynamically. Dynamic IP addresses are obtained by hosts through use of <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">DHCP</span>.
  <li class="SmartList1"><a name="2742"> </a>Support for unicast <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP</span> and multicast <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">UDP</span>. The former is used by subsystems using Jini technology such as Java Remote Method Invocation (<span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">Java RMI</span>); both are used during discovery.
  <li class="SmartList1"><a name="2743"> </a>Provision of some mechanism, such as a simple <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">HTTP</span> server, that facilitates the downloading of code (for example, for service proxies or Java <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">Java RMI</span> stubs) by remote parties. This mechanism does not have to be provided by the host itself, but the code must be made available by some cooperating party.
</ul>

<h4 class="Heading3">
  <a name="2540"> </a>DJ.1.3	 Protocol Overview
</h4>
<p class="Body">
  <a name="3769"> </a>There are three related discovery protocols, each designed with different purposes:
</p>
<ul>

  <li class="SmartList1"><a name="3770"> </a>The <em class="Emphasis">multicast request protocol</em> is employed by entities that wish to discover nearby lookup services. This is the protocol used by services that are starting up and need to locate whatever djinns happen to be close. It can also be used to support browsing of local lookup services.
  <li class="SmartList1"><a name="3773"> </a>The <em class="Emphasis">multicast announcement protocol</em> is provided to allow lookup services to advertise their existence. This protocol is useful in two situations. When a new lookup service is started, it might need to announce its availability to potential clients. Also, if a network failure occurs and clients lose track of a lookup service, this protocol can be used to make them aware of its availability after network service has been restored.
  <li class="SmartList1"><a name="3774"> </a>The <em class="Emphasis">unicast discovery protocol</em> makes it possible for an entity to communicate with a specific lookup service. This is useful for dealing with non-local djinns and for using services in specific djinns over a long period of time.
</ul>

<p class="Body">
  <a name="2532"> </a>The discovery protocols require support for multicast or restricted-scope broadcast, along with support for reliable unicast delivery, in the transport layer. The discovery protocols make use of the Java platform's I/O libraries to exchange information in a platform-independent manner.
</p>
<h4 class="Heading3">
  <a name="3554"> </a>DJ.1.4	 Discovery in Brief
</h4>
<p class="Body">
  <a name="4050"> </a>This section provides a brief overview of the operation of the discovery protocols. For a detailed description suitable for use by implementors, see <a href="#19702">Section DJ.2 "The Discovery Protocols"</a>.
</p>
<h5 class="Heading4">
  <a name="3814"> </a>DJ.1.4.1	 Groups
</h5>
<p class="Body">
  <a name="3815"> </a>A group is an arbitrary string that acts as a name. Each lookup service has a set of zero or more groups associated with it. Entities using the multicast request protocol specify a set of groups they want to communicate with, and lookup services advertise the groups they are associated with using the multicast announcement protocol. This allows for flexibility in configuring entities: instead of maintaining a set of <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">URL</span>s for specific lookup services that needs to be updated if any of the services change address, an entity can use a set of group names.
</p>
<p class="Body">
  <a name="4237"> </a>Although group names are arbitrary strings, it is recommended that <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">DNS</span>-style names (for example, "eng.sun.com") be used to avoid name conflicts. One group name, represented by the empty string, is predefined as the <em class="Emphasis">public</em> group. Unless otherwise configured, lookup services should default to being members of the public group, and discovering entities should attempt to find lookup services in the public group.
</p>
<h5 class="Heading4">
  <a name="40012"> </a>DJ.1.4.2	 The Multicast Request Protocol
</h5>
<p class="Body">
  <a name="40013"> </a>The multicast request protocol, shown in Figure DJ.1.1, proceeds as follows:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="40014"> </a>The entity that wishes to discover a djinn establishes a <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP</span>-based server that accepts references to the lookup service. This server is an instance of the <em class="Emphasis">multicast response</em> service.
      <li class="SmartList3" value="2"><a name="2579"> </a>Lookup services listen for multicast requests for references to lookup services for the groups they manage. These listening entities are instances of the <em class="Emphasis">multicast request</em> service. This is <em class="Emphasis">not</em> an <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">Java RMI</span>-based service; the protocol is described in <a href="#19702">Section DJ.2 "The Discovery Protocols"</a>.
      <li class="SmartList3" value="3"><a name="2578"> </a>The discovering entity performs a multicast that requests references to lookup services; it provides a set of groups in which it is interested, and enough information to allow listeners to connect to its multicast response server.
      <li class="SmartList3" value="4"><a name="39865"> </a>Each multicast request server that receives the multicast checks if it is a member of a group specified in the request; if it is, it connects to the multicast response server described in the request, and uses the unicast discovery protocol to pass an instance of the lookup service's implementation of <code>net.jini.core.lookup.ServiceRegistrar</code>.
    </ol>
<p class="Body">
  <a name="2593"> </a>At this point, the discovering entity will have obtained one or more remote references to lookup services.
</p>
<p>
<CENTER>
<img src="images/discovery-speca.gif" alt="This image illustrates the steps listed in DJ.1.4.2, the section immediately above." height="364" width="490">
</CENTER>
</p>


</p>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: italic; font-weight: bold; margin-bottom: 17pt; margin-left: 54pt; margin-right: 0pt; margin-top: 7pt; text-align: left; text-decoration: none; text-indent: -54pt; text-transform: none; vertical-align: baseline">
<a name="39235"> </a>Figure DJ.1.1:	 The Multicast Request Protocol<br>
</div>
<h5 class="Heading4">
  <a name="3764"> </a>DJ.1.4.3	 The Multicast Announcement Protocol
</h5>
<p class="Body">
  <a name="3793"> </a>The multicast announcement protocol follows these steps:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="3853"> </a>Interested entities on the network listen for multicast announcements of the existence of lookup services. If an announcement of interest arrives at such an entity, it uses the unicast discovery protocol to contact the given lookup service.
      <li class="SmartList3" value="2"><a name="3856"> </a>Lookup services prepare to take part in the unicast discovery protocol (see below) and send multicast announcements of their existence at regular intervals.
    </ol>
<h5 class="Heading4">
  <a name="3794"> </a>DJ.1.4.4	 The Unicast Discovery Protocol
</h5>
<p class="Body">
  <a name="3795"> </a>The unicast discovery protocol works as follows:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="3859"> </a>The lookup service establishes a TCP-based server, on which it listens for incoming connections. When a connection is made by a client, the lookup service reads in request data sent by the client; if the request is acceptable, the lookup service responds by sending an object that implements the <code>net.jini.core.lookup.ServiceRegistrar</code> interface over the connection.
      <li class="SmartList3" value="2"><a name="3860"> </a>An entity that wishes to contact a particular lookup service uses known host and port information to establish a connection to that service. It sends a discovery request and, if the request is accepted, receives a <code>ServiceRegistrar</code> object in response.
    </ol>
<h3 class="Heading2">
  <a name="19702"> </a>DJ.2	 The Discovery Protocols
</h3>
<p class="Body">
  <a name="41527"> </a>The discovery process involves three closely related protocols: the multicast request protocol, used to discover one or more lookup services on a local area network (<span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">LAN</span>); the multicast announcement protocol, used to announce the presence of a lookup service on a local network; and the unicast discovery protocol, used to establish communications over a local area or wide area network (WAN) with a lookup service whose address is known in advance.
</p>
<h4 class="Heading3">
  <a name="41528"> </a>DJ.2.1	 Protocol Versions
</h4>
<p class="Body">
  <a name="41534"> </a>For each of the three discovery protocols, two versions exist: protocol version 1, which refers to the original protocol described in versions 1.0 through 1.2 of this specification, and protocol version 2, introduced in version 2.0 of this specification. Versions 1 and 2 of the various discovery protocols differ primarily in the encoded representation of data sent between discovering entities and lookup services; the overall pattern of interaction dictated by each of the three protocols is the same in each version. Unless otherwise specified, statements about a particular protocol in this specification apply to both versions 1 and 2 of that protocol.
</p>
<h4 class="Heading3">
  <a name="41551"> </a>DJ.2.2	 Discovery Formats
</h4>
<p class="Body">
  <a name="41553"> </a>For each of the three discovery protocols, version 1 of that protocol dictates a specific encoding for the data to be sent as part of the protocol. For example, version 1 of the multicast request protocol specifies a data encoding for multicast packets in which the first 4 bytes of data (following the protocol version) contain the port number for the multicast response server of the discovering entity; values for the number of lookup services known to the discovering entity, the service IDs for those lookup services, the number of groups of interest, and the names of those groups then follow in fixed order and format, as described in <a href="#19048">Section DJ.2.4.4 "Protocol Version 1 Request Packet Format"</a>.
</p>
<p class="Body">
  <a name="42010"> </a>In contrast, version 2 of each of the discovery protocols does not specify a fixed encoding for a subset of the data sent in requests and response messages. Rather, multicast requests, multicast responses, and unicast responses each carry a 64-bit <em class="Emphasis">discovery format ID</em> which uniquely identifies a <em class="Emphasis">discovery format</em>; this format ID is followed by <em class="Emphasis">discovery format data</em> (such as service IDs, group names, host names, and port numbers) encoded according to the indicated discovery format. The discovery format specifies how discovery format data is encoded; the discovery protocol defines a top-level message structure whose primary function is to identify the discovery format in effect for the discovery format data. The set of values that constitute the discovery format data varies depending on whether the data is for the multicast request, multicast announcement, or unicast discovery protocol; the values to be included as part of the discovery format data for each protocol are listed in the section describing version 2 of that protocol.
</p>
<p class="Body">
  <a name="43014"> </a>Note that a single discovery format can encompass more than one discovery protocol, though it is not required to cover all three. For example, the <code>net.jini.discovery.x500.SHA1withDSA</code> format (specified in <a href="#43655">Section DJ.3.2</a>) applies to the multicast request and announcement protocols, but not to the unicast discovery protocol.
</p>
<h5 class="Heading4">
  <a name="41603"> </a>DJ.2.2.1	 Discovery Format Names
</h5>
<p class="Body">
  <a name="41612"> </a>Each discovery format is uniquely identified by a <em class="Emphasis">discovery format name</em>, from which its discovery format ID is derived. Discovery format names are case sensitive. To avoid name collisions, discovery format names should follow the same reverse DNS naming convention recommended for Java package names in Section 7.7 of the <em class="Emphasis">Java Language Specification, Second Edition</em>. Examples of format names are <code>net.jini.discovery.x500.SHA1withDSA</code>, <code>net.jini.discovery.ssl</code>, and <code>net.jini.discovery.kerberos</code> (the formats associated with these names are specified in Sections <a href="#43655">DJ.3.2</a>, <a href="#42919">DJ.3.4</a>, and <a href="#43699">DJ.3.5</a>, respectively).
</p>
<h5 class="Heading4">
  <a name="41604"> </a>DJ.2.2.2	 Discovery Format IDs
</h5>
<p class="Body">
  <a name="41623"> </a>The discovery format ID for a given discovery format is a 64-bit value based on a hash of the discovery format name, computed as follows: first, the discovery format name is converted into a byte sequence obtained by generating the UTF-8 encoding for the format name. This byte sequence is then used as input to the SHA-1 hash function; the discovery format ID consists of the first (most significant) 64 bits of the SHA-1 hash result.  The discovery format ID with value <code>0</code> is called the <em class="Emphasis">null discovery format ID</em>, and is reserved. The SHA-1 hash function is specified in <em class="Emphasis">Federal Information Processing Standards Publication (FIPS PUB) 180-1</em>.  The UTF-8 encoding is specified in <em>RFC 2279</em>.
</p>
<h4 class="Heading3">
  <a name="41533"> </a>DJ.2.3	 Protocol Roles
</h4>
<p class="Body">
  <a name="18995"> </a>The multicast discovery protocols work together over time. When an entity is initially started, it uses the multicast request protocol to actively seek out nearby lookup services. After a limited period of time performing active discovery in this way, it ceases using the multicast request protocol and switches over to listening for multicast lookup announcements via the multicast announcement protocol.
</p>
<h4 class="Heading3">
  <a name="40029"> </a>DJ.2.4	 The Multicast Request Protocol
</h4>
<p class="Body">
  <a name="40030"> </a>The multicast request protocol allows an entity that has just been started, or that needs to provide browsing capabilities to a user, to actively discover nearby lookup services.
</p>
<h5 class="Heading4">
  <a name="18998"> </a>DJ.2.4.1	 Protocol Participants
</h5>
<p class="Body">
  <a name="41633"> </a>Several components take part in the multicast request protocol. Of these, two run on an entity that is performing multicast requests, and two run on the entity that listens for such requests and responds.
</p>
<p class="Body">
  <a name="41634"> </a>On the requesting side live the following components:
</p>
<ul>

  <li class="SmartList1"><a name="41635"> </a>A multicast request client performs multicasts to discover nearby lookup services.
  <li class="SmartList1"><a name="19002"> </a>A multicast response server listens for responses from those lookup services.
</ul>

<p class="Body">
  <a name="19003"> </a>These components are paired; they do not occur separately. Any number of pairs of such components may coexist in a single <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">JVM</span> at any given time.
</p>
<p class="Body">
  <a name="19004"> </a>The lookup service houses the other two participants:
</p>
<ul>

  <li class="SmartList1"><a name="19005"> </a>A multicast request server listens for incoming multicast requests.
  <li class="SmartList1"><a name="19006"> </a>A multicast response client responds to callers, passing each a proxy that allows it to communicate with its lookup service.
</ul>

<p class="Body">
  <a name="19007"> </a>Although these components are paired, as on the client side, only a single pair will typically be associated with each lookup service.
</p>
<p class="Body">
  <a name="40612"> </a>These local pairings apart, the remote client/server pairings should be clear from the above description and the diagram of protocol participants in Figure DJ.2.1.
</p>
<p>
<CENTER>
<img src="images/discovery-spec2.gif" alt="This image illustrates the interrelationship of the components discussed in DJ.2.2.1." height="330" width="480">
</CENTER>
</p>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: italic; font-weight: bold; margin-bottom: 17pt; margin-left: 54pt; margin-right: 0pt; margin-top: 7pt; text-align: left; text-decoration: none; text-indent: -54pt; text-transform: none; vertical-align: baseline">
<a name="40654"> </a>Figure DJ.2.1:	 Multicast Request Protocol Participants<br>
</div>
<h5 class="Heading4">
  <a name="19046"> </a>DJ.2.4.2	 The Multicast Request Service
</h5>
<p class="Body">
  <a name="19047"> </a>The multicast request service is not based on Java <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">Java RMI</span>; instead, it makes use of the multicast datagram facility of the networking transport layer to request that lookup services advertise their availability to a requesting host. In a <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP/IP</span> environment the network protocol used is multicast <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">UDP</span>. Request datagrams are encoded as a sequence of bytes, using the I/O facilities of the Java programming language to provide platform independence.
</p>
<h5 class="Heading4">
  <a name="41642"> </a>DJ.2.4.3	 Request Packet Contents
</h5>
<p class="Body">
  <a name="41643"> </a>Each multicast request packet carries the following values:
</p>
<ul>

  <li class="SmartList1"><a name="41650"> </a>The<em class="Emphasis"> protocol version</em> value is an integer that indicates the version of the multicast request protocol in use. Currently, the only valid protocol version numbers are 1 and 2.
  <li class="SmartList1"><a name="41645"> </a>The<em class="Emphasis"> multicast response port</em> value is an integer representing the TCP port number of the discovering entity's multicast response server.
  <li class="SmartList1"><a name="41651"> </a>The<em class="Emphasis"> requested groups</em> value is a set of strings naming the groups that the discovering entity wishes to discover. This set may be empty, which indicates that discovery of all groups is requested.
  <li class="SmartList1"><a name="41652"> </a>The<em class="Emphasis"> heard lookup service IDs </em>value is a set of service IDs identifying lookup services from which the discovering entity has already heard, and which do not need to respond to the request.
</ul>

<p class="Body">
  <a name="41653"> </a>Protocol version 2 multicast request packets additionally carry at least the following values:
</p>
<ul>

  <li class="SmartList1"><a name="41663"> </a>The<em class="Emphasis"> discovery format ID </em>value is a 64-bit number indicating the discovery format in which the discovery format data of the packet has been encoded.
  <li class="SmartList1"><a name="41664"> </a>The<em class="Emphasis"> packet type</em> value is an integer used to distinguish between multicast request and announcement packets. For request packets, this value is always 1.
  <li class="SmartList1"><a name="41660"> </a>The<em class="Emphasis"> multicast response host</em> value is a string containing the host name or IP address that lookup services should use in order to contact the discovering entity's multicast response server. In version 1 of the multicast request protocol, this information is derived from the multicast packet's source address; the multicast response host is included as an explicit value in version 2 of the multicast request protocol in order to facilitate forwarding or tunneling of multicast request packets to remote networks.
</ul>

<p class="Body">
  <a name="43160"> </a>Protocol version 2 discovery formats may also specify additional values to be included in multicast request packets.
</p>
<h5 class="Heading4">
  <a name="19048"> </a>DJ.2.4.4	 Protocol Version 1 Request Packet Format
</h5>
<p class="Body">
  <a name="19163"> </a>The table below describes the contents of a multicast request protocol version 1 packet body.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="41731"> </a><div class="CellHeading">Count</div></th>
    <th><a name="41733"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="41735"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="41737"> </a>1</td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41739"> </a><code>int</code><br>
</div>
</td>
    <td><a name="41741"> </a><div class="CellBody">protocol version</div></td>
  </tr>
  <tr>
    <td align="right"><a name="41743"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41745"> </a><code>int</code><br>
</div>
</td>
    <td><a name="41747"> </a><div class="CellBody">multicast response port</div></td>
  </tr>
  <tr>
    <td align="right"><a name="41749"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41751"> </a><code>int</code><br>
</div>
</td>
    <td><a name="41753"> </a><div class="CellBody">service ID count</div></td>
  </tr>
  <tr>
    <td><a name="41755"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41757"> </a><code>net.jini.core.lookup.ServiceID</code><br>
</div>
</td>
    <td><a name="41759"> </a><div class="CellBody">heard lookup service IDs</div></td>
  </tr>
  <tr>
    <td align="right"><a name="41761"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41763"> </a><code>int</code><br>
</div>
</td>
    <td><a name="41765"> </a><div class="CellBody">group count</div></td>
  </tr>
  <tr>
    <td><a name="41767"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41769"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="41771"> </a><div class="CellBody">requested groups</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="41776"> </a>Packet contents consist of a contiguous series of values in the order listed above from top to bottom. Values of type <code>int</code> and <code>String</code> are encoded in the formats specified for the <code>writeInt</code> and <code>writeUTF</code> methods of the <code>java.io.DataOutput </code>interface, respectively. Values of type <code>ServiceID</code> are encoded in the format specified for the <code>ServiceID.writeBytes </code>method. The number of service IDs written must be equal to the service ID count value. The number of group strings written must be equal to the group count value.
</p>
<h5 class="Heading4">
  <a name="41882"> </a>DJ.2.4.5	 Protocol Version 2 Request Packet Format
</h5>
<p class="Body">
  <a name="41883"> </a>The table below describes the contents of a protocol version 2 multicast request packet body.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="41886"> </a><div class="CellHeading">Count</div></th>
    <th><a name="41888"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="41890"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="41892"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41894"> </a><code>int</code><br>
</div>
</td>
    <td><a name="41896"> </a><div class="CellBody">protocol version</div></td>
  </tr>
  <tr>
    <td align="right"><a name="41898"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41900"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="41902"> </a><div class="CellBody">multicast packet type</div></td>
  </tr>
  <tr>
    <td align="right"><a name="41904"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41906"> </a><code>long</code><br>
</div>
</td>
    <td><a name="41908"> </a><div class="CellBody">discovery format ID</div></td>
  </tr>
  <tr>
    <td><a name="41910"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="41912"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="41914"> </a><div class="CellBody">discovery format data</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="41772"> </a>Packet contents consist of a contiguous series of values in the order listed above from top to bottom. Values of type <code>byte</code>, <code>int</code>, and <code>long</code> are encoded in the formats specified for the <code>writeByte</code>, <code>writeInt</code>, and <code>writeLong</code> methods of the <code>java.io.DataOutput</code> interface, respectively. Discovery format data encompasses all data from the end of the discovery format ID to the end of the packet, and is encoded according to the discovery format indicated by the discovery format ID. The discovery format data for a protocol version 2 multicast request packet must include at least the following values, described in <a href="#41642">Section DJ.2.4.3 "Request Packet Contents"</a>:
</p>
<ul>

  <li class="SmartList1"><a name="41921"> </a>Multicast response host
  <li class="SmartList1"><a name="41922"> </a>Multicast response port
  <li class="SmartList1"><a name="41923"> </a>Requested groups
  <li class="SmartList1"><a name="41924"> </a>Heard lookup service IDs
</ul>

<h5 class="Heading4">
  <a name="41925"> </a>DJ.2.4.6	 Request Packet Size
</h5>
<p class="Body">
  <a name="41926"> </a>Multicast request packets should be limited in size to avoid packet fragmentation. A size limit of 512 bytes is recommended, though not required. If the size of a multicast request packet body exceeds the limit established for a given deployment, the set of heard lookup service IDs must be left incomplete in the packet body, such that the packet body will conform to the size limit. Discovering entities are not permitted to simply truncate multicast request packets at the size limit.
</p>
<p class="Body">
  <a name="19165"> </a>Similarly, if the number of requested groups causes the request packet body to exceed the size limit, the discovering entity must perform several separate multicasts, each with a disjoint subset of the full set of requested groups, until the entire set has been requested. Each request must contain the largest set of heard lookup service IDs possible without exceeding the size limit.
</p>
<h5 class="Heading4">
  <a name="19166"> </a>DJ.2.4.7	 The Multicast Response Service
</h5>
<p class="Body">
  <a name="19167"> </a>Unlike the multicast request service, the multicast response service is a normal <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP</span>-based service. In this service, the multicast response client contacts the multicast response server specified in a multicast request, after which unicast discovery is performed. In version 1 of the multicast request protocol, the multicast response server to contact is determined by using the source address of the request that has been received, along with the port number encapsulated in that request. In version 2 of the multicast request protocol, the host name or IP address of the response server to contact is included as an explicit value in the multicast request, in addition to the port number.
</p>
<p class="Body">
  <a name="19168"> </a>The only difference between the unicast discovery performed in this instance and the normal case is that the entity being connected to initiates unicast discovery, not the connecting entity. An alternative way of looking at this is that in both cases, once the connection has been established, the discovering entity initiates unicast discovery.
</p>
<h5 class="Heading4">
  <a name="19169"> </a>DJ.2.4.8	 Discovery Using the Multicast Request Protocol
</h5>
<p class="Body">
  <a name="19170"> </a>Described below is the discovery sequence for local area network (<span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">LAN</span>)-based environments that use the multicast request protocol to discover one or more djinns.
</p>
<p class="Body">
  <a name="19172"> </a>The entity that wishes to discover a djinn takes the following steps:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="19173"> </a>It establishes a multicast request client, which will send packets to the well-known multicast network endpoint on which the multicast request service operates.
      <li class="SmartList3" value="2"><a name="19174"> </a>It establishes a <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP</span> server socket that listens for incoming connections, over which the unicast discovery protocol is used. This server socket is the multicast response server socket.
      <li class="SmartList3" value="3"><a name="19175"> </a>It creates a set of <code>net.jini.core.lookup.ServiceID</code> objects. This set contains service IDs for lookup services from which it has already heard, and is initially empty.
      <li class="SmartList3" value="4"><a name="40999"> </a>It sends multicast requests at periodic intervals. Each request contains connection information for its multicast response server, a set of requested groups, and the most recent set of service IDs for lookup services it has heard from.
      <li class="SmartList3" value="5"><a name="40127"> </a>For each response it receives via the multicast response service, it adds the service ID for that lookup service to the set it maintains.
      <li class="SmartList3" value="6"><a name="19178"> </a>The entity continues multicasting requests for some period of time. Once this point has been reached, it shuts down its multicast response server and stops making multicast requests.
      <li class="SmartList3" value="7"><a name="19179"> </a>If the entity has received sufficient references to lookup services at this point, it is now finished. Otherwise, it must start using the multicast announcement protocol.
    </ol>
<p class="Body">
  <a name="40842"> </a>The interval at which requests are performed is not specified, though an interval of five seconds is recommended for most purposes. Similarly, the number of requests to perform is not mandated, but we recommend seven. Since requests may be broken down into a number of separate multicasts, these recommendations do not pertain to the number of packets to be sent.
</p>
<p class="Body">
  <a name="19182"> </a>The lookup service that hosts an instance of the multicast request service takes the following steps:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="19183"> </a>It binds a datagram socket to the well-known multicast endpoint on which the multicast request service lives so that it can receive incoming multicast requests.
      <li class="SmartList3" value="2"><a name="41979"> </a>When a multicast request is received, the discovery request server determines whether or not it should respond to the requesting entity as follows: if the service ID of the lookup service to which the request server belongs appears in the multicast request's list of heard lookup service IDs, the request server must not respond to the request. If the set of requested groups is non-empty, and none of the lookup service's own member groups appear in the set of requested groups, then the request server must not respond to the request.
	<p>The request server may additionally employ other criteria in deciding whether to respond: for example, a request server may be configured to only respond to protocol version 2 multicast requests that use the <code>net.jini.discovery.x500.SHA1withDSA</code> discovery format (specified in <a href="#43655">Section DJ.3.2</a>) and contain an authentication block with a valid signer. If the multicast request satisfies all additional conditions required by the request server, the request server must respond to the request.
      <li class="SmartList3" value="3"><a name="41982"> </a>If the entity must be responded to, the request server connects to the other party's multicast response server using the information provided in the request, and provides a lookup service registrar using the unicast discovery protocol.
    </ol>
<h5 class="Heading4">
  <a name="19186"> </a>DJ.2.4.9	 Handling Responses from Multiple Djinns
</h5>
<p class="Body">
  <a name="19187"> </a>The actions taken when there are several djinns on a network, and calls to an entity's discovery response service are made by principals from more than one of those djinns, will depend on the nature of the discovering entity. Possible approaches include the following:
</p>
<p class="Body">
  <a name="43794"> </a>If the entity provides a <em class="Emphasis">finder</em>-style visual interface that allows a user to choose one or more djinns for their system to join, it should loop at step 4 in <a href="#19169">Section DJ.2.4.8</a>, and provide the ability to:
</p>
<ul>

  <li class="SmartList1"><a name="19189"> </a>Display the names and descriptions of the djinns it has found out about
  <li class="SmartList1"><a name="19190"> </a>Allow the user to select zero or more djinns to join
  <li class="SmartList1"><a name="19191"> </a>Continue to dynamically update its display, until the user has finished their selection
  <li class="SmartList1"><a name="19192"> </a>Attempt to join all of those djinns the user selected
</ul>

<p class="Body">
  <a name="19193"> </a>On the other hand, if the behavior of the entity is fully automated, it should follow the join protocol described in <a href="#43752">Section DJ.4 "The Join Protocol"</a>.
</p>
<h4 class="Heading3">
  <a name="19194"> </a>DJ.2.5	 The Multicast Announcement Protocol
</h4>
<p class="Body">
  <a name="19195"> </a>The multicast announcement protocol is used by Jini lookup services to announce their availability to interested parties within multicast radius. Participants in this protocol are the multicast announcement client, which resides on the same system as a lookup service, and the multicast announcement server, at least one instance of which exists on every entity that listens for such announcements.
</p>
<p class="Body">
  <a name="19196"> </a>The multicast announcement client is a long-lived process; it must start at about the same time as the lookup service itself and remain running as long as the lookup service is alive.
</p>
<h5 class="Heading4">
  <a name="42026"> </a>DJ.2.5.1	 Announcement Packet Contents
</h5>
<p class="Body">
  <a name="19198"> </a>The multicast announcement service uses multicast datagrams to communicate from a single client to an arbitrary number of servers. In a <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP/IP</span> environment the underlying protocol used is multicast <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">UDP</span>. Each multicast announcement packet carries the following values:
</p>
<ul>

  <li class="SmartList1"><a name="42035"> </a>The<em class="Emphasis"> protocol version</em> value is an integer that indicates the version of the multicast announcement protocol in use. Currently, the only valid protocol version numbers are 1 and 2.
  <li class="SmartList1"><a name="42036"> </a>The<em class="Emphasis"> unicast discovery host</em> value is a string containing the host name or IP address that discovering entities should use in order to connect to the lookup service's unicast discovery server.
  <li class="SmartList1"><a name="42037"> </a>The<em class="Emphasis"> unicast discovery port</em> value is an integer representing the TCP port number of the lookup service's unicast discovery server.
  <li class="SmartList1"><a name="42038"> </a>The<em class="Emphasis"> lookup service ID</em> value is the service ID of the lookup service.
  <li class="SmartList1"><a name="42039"> </a>The<em class="Emphasis"> member groups</em> value is a set of strings naming the discovery groups to which the lookup service belongs.
</ul>

<p class="Body">
  <a name="42048"> </a>Protocol version 2 multicast announcement packets additionally carry at least the following values:
</p>
<ul>

  <li class="SmartList1"><a name="42608"> </a>The<em class="Emphasis"> discovery format ID</em> value is a 64-bit number indicating the discovery format in which the discovery format data of the packet has been encoded.
  <li class="SmartList1"><a name="42609"> </a>The<em class="Emphasis"> packet type</em> value is an integer used to distinguish between multicast request and announcement packets. For announcement packets, this value is always 0.
  <li class="SmartList1"><a name="43085"> </a>The<em class="Emphasis"> sequence number</em> value is a 64-bit number used to distinguish outdated multicast announcements from new ones. A lookup service must increase the sequence number for each multicast announcement with changed data that is sent. Use of sequence numbers is discussed further in <a href="#42352">Section DJ.2.5.6, "Announcement Sequence Numbers"</a>.
</ul>

<p class="Body">
  <a name="43161"> </a>Protocol version 2 discovery formats may also specify additional values to be included in multicast announcement packets.
</p>
<h5 class="Heading4">
  <a name="43086"> </a>DJ.2.5.2	 Protocol Version 1 Announcement Packet Format
</h5>
<p class="Body">
  <a name="42119"> </a>The table below describes the contents of a protocol version 1 multicast announcement packet body.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="42124"> </a><div class="CellHeading">Count</div></th>
    <th><a name="42126"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="42128"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="42130"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42132"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42134"> </a><div class="CellBody">protocol version</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42136"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42138"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="42140"> </a><div class="CellBody">unicast discovery host</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42142"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42144"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42146"> </a><div class="CellBody">unicast discovery port</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42148"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42150"> </a><code>net.jini.core.lookup.ServiceID</code><br>
</div>
</td>
    <td><a name="42152"> </a><div class="CellBody">lookup service ID</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42154"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42156"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42158"> </a><div class="CellBody">group count</div></td>
  </tr>
  <tr>
    <td><a name="42160"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42162"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="42164"> </a><div class="CellBody">member groups</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="19256"> </a>Packet contents consist of a contiguous series of values in the order listed above from top to bottom. Values of type <code>int</code> and <code>String</code> are encoded in the formats specified for the <code>writeInt</code> and <code>writeUTF</code> methods of the <code>java.io.DataOutput</code> interface, respectively. The <code>ServiceID</code> value is encoded in the format specified for the <code>ServiceID.writeBytes</code> method. The number of group strings written must be equal to the group count value.
</p>
<h5 class="Heading4">
  <a name="42188"> </a>DJ.2.5.3	 Protocol Version 2 Announcement Packet Format
</h5>
<p class="Body">
  <a name="42191"> </a>The table below describes the contents of a protocol version 2 multicast announcement packet body.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="42194"> </a><div class="CellHeading">Count</div></th>
    <th><a name="42196"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="42198"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="42200"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42202"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42204"> </a><div class="CellBody">protocol version</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42206"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42208"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="42210"> </a><div class="CellBody">multicast packet type</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42212"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42214"> </a><code>long</code><br>
</div>
</td>
    <td><a name="42216"> </a><div class="CellBody">discovery format ID</div></td>
  </tr>
  <tr>
    <td><a name="42230"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42232"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="42234"> </a><div class="CellBody">discovery format data</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="42246"> </a>Packet contents consist of a contiguous series of values in the order listed above from top to bottom. Values of type <code>byte</code>, <code>int</code>, and <code>long</code> are encoded in the formats specified for the <code>writeByte</code>, <code>writeInt</code>, and <code>writeLong</code> methods of the <code>java.io.DataOutput</code> interface, respectively. Discovery format data encompasses all data from the end of the discovery format ID to the end of the packet, and is encoded according to the discovery format indicated by the discovery format ID. The discovery format data for a protocol version 2 multicast announcement packet must include at least the following values, described in <a href="#42026">Section DJ.2.5.1 "Announcement Packet Contents"</a>:
</p>
<ul>

  <li class="SmartList1"><a name="42261"> </a>Unicast discovery host
  <li class="SmartList1"><a name="42262"> </a>Unicast discovery port
  <li class="SmartList1"><a name="43169"> </a>Lookup service ID
  <li class="SmartList1"><a name="43185"> </a>Member groups
  <li class="SmartList1"><a name="43176"> </a>Sequence number
</ul>

<h5 class="Heading4">
  <a name="43171"> </a>DJ.2.5.4	 Announcement Packet Size
</h5>
<p class="Body">
  <a name="42266"> </a>Multicast announcement packets should be limited in size to avoid packet fragmentation. A size limit of 512 bytes is recommended, though not required. If the size of a multicast announcement packet body exceeds the limit established for a given deployment, the lookup service must perform several separate multicasts, each with a disjoint subset of the full set of member groups, such that the full set of member groups is represented by the union of all packets. Lookup services are not permitted to simply truncate multicast announcements at the size limit.
</p>
<h5 class="Heading4">
  <a name="19257"> </a>DJ.2.5.5	 Discovery Using the Multicast Announcement Protocol
</h5>
<p class="Body">
  <a name="19258"> </a>Described below is the sequence of actions that are taken by a lookup service and discovering entity when participating in the multicast announcement protocol.
</p>
<p class="Body">
  <a name="42296"> </a>The lookup service takes the following steps:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="19259"> </a>It constructs a datagram socket object, set up to send to the well-known multicast endpoint on which the multicast announcement service operates.
      <li class="SmartList3" value="2"><a name="19260"> </a>It establishes the server side of the unicast discovery service.
      <li class="SmartList3" value="3"><a name="19261"> </a>It multicasts announcement packets at intervals. The length of the interval is not mandated, but 120 seconds is recommended.
    </ol>
<p class="Body">
  <a name="19262"> </a>An entity that wishes to listen for multicast announcements performs the following set of steps:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="19263"> </a>It establishes a set of service IDs of lookup services from which it has already heard, using the set discovered by using the multicast request protocol as the initial contents of this set.
      <li class="SmartList3" value="2"><a name="42316"> </a>It binds a datagram socket to the well-known multicast endpoint on which the multicast announcement service operates and listens for incoming multicast announcements.
      <li class="SmartList3" value="3"><a name="42317"> </a>When a multicast announcement is received, the discovering entity determines whether or not to attempt unicast discovery to the announcing lookup service as follows: if the announcement's lookup service ID is contained in the set of service IDs from which the discovering entity has already heard, then the discovering entity must not perform unicast discovery. If the member groups listed in the announcement do not intersect with the discovering entity's groups of interest, then the discovering entity must not perform unicast discovery.
    <p>The discovering entity may additionally employ other criteria in deciding whether to perform unicast discovery: for example, it may be configured to only perform unicast discovery in response to protocol 2 multicast announcements using the <code>net.jini.discovery.x500.SHA1withDSA</code> discovery format (specified in <a href="#43655">Section DJ.3.2</a>) that contain an authentication block with a recognized signer. If the multicast announcement satisfies all additional conditions required by the discovering entity, then the discovering entity should perform unicast discovery using the host and port contained in the announcement; if unicast discovery succeeds, it should then add the service ID of the discovered lookup service to its set of heard lookup service IDs.
    </ol>
<h5 class="Heading4">
  <a name="42352"> </a>DJ.2.5.6	 Announcement Sequence Numbers
</h5>
<p class="Body">
  <a name="42372"> </a>Protocol version 2 multicast announcements carry sequence numbers, which can be used by discovering entities to filter out outdated multicast announcements. Lookup services must ensure that a multicast announcement sent in a given announcement interval has a sequence number higher than that of the announcement sent in the preceding interval if the data represented by the two announcements differs. If the data for the two announcements is identical, then the lookup service must use a sequence number higher than or equal to that of the earlier multicast announcement. If the multicast announcement must be split due to size limitations (as described in <a href="#43171">Section DJ.2.5.4 "Announcement Packet Size"</a>), the same rule applies to the resulting announcements as a group--each announcement in the group shares the same sequence number, which must be greater than the sequence number of the multicast announcement(s) sent in the previous interval, if the represented data differs.
</p>
<p class="Body">
  <a name="42410"> </a>Sequence numbers are primarily useful when coupled with a discovery format that guarantees multicast announcement data integrity. In this case, a discovering entity can guard against replayed multicast announcements by verifying that the sequence number of a received announcement is greater than or equal to the sequence number of the announcement most recently received from the announcing lookup service.
</p>
<h4 class="Heading3">
  <a name="42373"> </a>DJ.2.6	 The Unicast Discovery Protocol
</h4>
<p class="Body">
  <a name="42366"> </a>The unicast discovery protocol is used to obtain a reference to a lookup service with a known address. It is also employed as the last step of multicast discovery, after a connection to the lookup service's unicast discovery server has been established through either the multicast announcement or multicast request protocol. Unicast discovery is particularly useful for obtaining references to distant lookup services located outside of multicast range.
</p>
<p class="Body">
  <a name="19268"> </a>The unicast discovery protocol uses the underlying reliable unicast transport protocol provided by the network instead of the unreliable multicast transport. In the case of IP-based networks this means that the unicast discovery protocol uses unicast <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP</span> instead of multicast <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">UDP</span>.
</p>
<h5 class="Heading4">
  <a name="19269"> </a>DJ.2.6.1	 The Protocol
</h5>
<p class="Body">
  <a name="19270"> </a>The unicast discovery protocol is fundamentally a simple request-response protocol. In version 2 of the protocol, discovery formats may specify additional communication over the unicast connection, though the overall pattern of interaction remains the same: the discovering entity requests a reference to the lookup service, and the lookup service responds by sending its proxy to the client.
</p>
<p class="Body">
  <a name="42526"> </a>To initiate unicast discovery, the discovering entity opens a TCP connection to the host and port of the lookup service's unicast discovery server. In the case of standalone unicast discovery, the host and port are typically obtained from a <code>net.jini.core.discovery.LookupLocator</code> instance; if unicast discovery is occurring as the final stage of the multicast announcement protocol, the host and port are obtained from the multicast announcement packet. The discovering entity then sends a unicast discovery request over the connection. If the lookup service determines that the request is acceptable, it responds by transmitting its proxy--an object implementing the <code>net.jini.core.lookup.ServiceRegistrar</code> interface--over the connection to the discovering entity. 
</p>
<p class="Body">
  <a name="42547"> </a>Unicast discovery may also be initiated by the lookup service. In the final stage of the multicast request protocol, the lookup service responds to a multicast request by opening a TCP connection to the discovering entity's multicast response server, whose host and port are indicated by the multicast request. The multicast response server accepts the connection and sends a unicast discovery request over it to the lookup service. As in the case of discovery entity-initiated unicast discovery, the lookup service may then respond by sending its proxy, if the request is deemed acceptable.
</p>
<p class="Body">
  <a name="42576"> </a>The protocol diagram in Figure DJ.2.2</a> illustrates the sequence of events when unicast discovery is initiated by a discovering entity.
</p>
<p><CENTER>
<img src="images/discovery-spec3.gif" alt="This image illustrates the actions described in DJ.2.5.1, when a discovering entity is the initiator." height="207" width="480">

</CENTER></p>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: italic; font-weight: bold; margin-bottom: 17pt; margin-left: 54pt; margin-right: 0pt; margin-top: 7pt; text-align: left; text-decoration: none; text-indent: -54pt; text-transform: none; vertical-align: baseline">
<a name="42571"> </a>Figure DJ.2.2:	 Unicast Discovery Initiated by a Discovering Entity<br>
</div>
<p class="Body">
  <a name="42514"> </a>The protocol diagram in Figure DJ.2.3 illustrates the sequence of events when a lookup service initiates unicast discovery in response to a multicast request.
</p>
<p><CENTER>
<img src="images/discovery-spec4.gif" alt="This image illustrates the actions described in DJ.2.5.1, when a lookup service is the initiator." height="233" width="480">

</CENTER></p>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: italic; font-weight: bold; margin-bottom: 17pt; margin-left: 54pt; margin-right: 0pt; margin-top: 7pt; text-align: left; text-decoration: none; text-indent: -54pt; text-transform: none; vertical-align: baseline">
<a name="40189"> </a>Figure DJ.2.3:	 Unicast Discovery Initiated by a Lookup Service<br>
</div>
<h5 class="Heading4">
  <a name="19328"> </a>DJ.2.6.2	 Unicast Request Contents
</h5>
<p class="Body">
  <a name="42593"> </a>Each unicast request carries the following value:
</p>
<ul>

  <li class="SmartList1"><a name="42594"> </a>The<em class="Emphasis"> protocol version</em> value is an integer that indicates the version of the unicast discovery protocol in use. Currently, the only valid protocol version numbers are 1 and 2.
</ul>

<p class="Body">
  <a name="42600"> </a>Protocol version 2 unicast requests additionally carry the following value:
</p>
<ul>

  <li class="SmartList1"><a name="42601"> </a>The<em class="Emphasis"> proposed format IDs</em> value is a list of 64-bit numbers indicating the discovery formats that the discovering entity is willing to use for unicast discovery. It is ordered in terms of preference, with discovery format IDs for preferred discovery formats appearing first.
</ul>

<h5 class="Heading4">
  <a name="42618"> </a>DJ.2.6.3	 Unicast Response Contents
</h5>
<p class="Body">
  <a name="42602"> </a>Each unicast response carries the following values:
</p>
<ul>

  <li class="SmartList1"><a name="42603"> </a>The<em class="Emphasis"> registrar proxy</em> value is the proxy object for the lookup service, which implements the <code>net.jini.core.lookup.ServiceRegistrar</code> interface.
  <li class="SmartList1"><a name="42604"> </a>The<em class="Emphasis"> member groups</em> value is a set of strings naming the discovery groups to which the lookup service belongs.
</ul>

<p class="Body">
  <a name="42606"> </a>Protocol version 2 unicast responses additionally carry at least the following values:
</p>
<ul>

  <li class="SmartList1"><a name="42706"> </a>The<em class="Emphasis"> protocol version</em> value is an integer that indicates the version of the unicast discovery protocol in use. Currently, the only valid protocol version numbers are 1 and 2.
  <li class="SmartList1"><a name="42607"> </a>The<em class="Emphasis"> selected format ID</em> value is a 64-bit number indicating the discovery format in which the rest of the data sent over the connection (potentially in both directions) will be encoded. This value must be one of the proposed format IDs contained in the corresponding unicast request, or the null format ID. In the case of a null format ID, the response only contains the <em>protocol version</em> and <em>format ID</em>.
  <li class="SmartList1"><a name="42615"> </a>The<em class="Emphasis"> unicast discovery host</em> value is a string containing the host name or IP address that discovering entities should use in order to connect to the lookup service's unicast discovery server.
  <li class="SmartList1"><a name="42616"> </a>The<em class="Emphasis"> unicast discovery port</em> value is an integer representing the TCP port number of the lookup service's unicast discovery server.
</ul>

<p class="Body">
  <a name="43194"> </a>Protocol version 2 discovery formats may also specify additional values to be included in unicast responses.
</p>
<h5 class="Heading4">
  <a name="42596"> </a>DJ.2.6.4	 Protocol Version 1 Request Format
</h5>
<p class="Body">
  <a name="42597"> </a>The table below describes the contents of a protocol version 1 unicast request.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="42624"> </a><div class="CellHeading">Count</div></th>
    <th><a name="42626"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="42628"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="42630"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42632"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42634"> </a><div class="CellBody">protocol version</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="42620"> </a>The <code>int</code> protocol version value is encoded in the format specified for the <code>writeInt</code> method of the <code>java.io.DataOutput</code> interface.
</p>
<h5 class="Heading4">
  <a name="42659"> </a>DJ.2.6.5	 Protocol Version 1 Response Format
</h5>
<p class="Body">
  <a name="42660"> </a>The table below describes the contents of a protocol version 1 unicast response.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="42666"> </a><div class="CellHeading">Count</div></th>
    <th><a name="42668"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="42670"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="42672"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42674"> </a><code>java.rmi.MarshalledObject</code><br>
</div>
</td>
    <td><a name="42676"> </a><div class="CellBody">registrar proxy</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42678"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42680"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42682"> </a><div class="CellBody">group count</div></td>
  </tr>
  <tr>
    <td><a name="42690"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42692"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="42694"> </a><div class="CellBody">member groups</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="42658"> </a>Packet contents consist of a contiguous series of values in the order listed above from top to bottom. The registrar proxy is written in the same format that would be produced by constructing a <code>java.io.ObjectOutputStream</code>, and writing to it an instance of <code>java.rmi.MarshalledObject</code> containing the marshalled registrar proxy. Values of type <code>int</code> and <code>String</code> are encoded in the formats that would be generated by calling the <code>writeInt</code> and <code>writeUTF</code> methods of the same <code>ObjectOutputStream</code> instance used to write the <code>MarshalledObject</code> containing the registrar proxy. The number of group strings written must be equal to the group count value.
</p>
<h5 class="Heading4">
  <a name="42723"> </a>DJ.2.6.6	 Protocol Version 2 Request Format
</h5>
<p class="Body">
  <a name="42724"> </a>The table below describes the contents of a protocol version 2 unicast request.
</p>
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="42731"> </a><div class="CellHeading">Count</div></th>
    <th><a name="42733"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="42735"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="42737"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42739"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42741"> </a><div class="CellBody">protocol version</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42743"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42745"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="42747"> </a><div class="CellBody">proposed format ID count</div></td>
  </tr>
  <tr>
    <td><a name="42755"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42757"> </a><code>long</code><br>
</div>
</td>
    <td><a name="42759"> </a><div class="CellBody">proposed format IDs</div></td>
  </tr>
</table>



<p class="Body">
  <a name="42725"> </a>Packet contents consist of a contiguous series of values in the order listed above from top to bottom. Values of type <code>int</code> and <code>long</code> are encoded in the formats specified for the <code>writeInt</code> and <code>writeLong</code> methods of the <code>java.io.DataOutput</code> interface, respectively. The unsigned <code>short</code> value is encoded as if it were cast to a signed <code>short</code> value, and then written in the format specified for the <code>writeShort</code> method of the <code>java.io.DataOutput</code> interface. The number of discovery format ID values written must be equal to the proposed format ID count value.
</p>
<p class="Body">
  <a name="42788"> </a>Note that after the protocol version 2 response has been read, the discovering entity may write additional data to the connection following the last element of the request, if so dictated by the selected discovery format indicated in the response. However, since this data is discovery format dependent and is written (if called for) only after receipt of the unicast response, it is not considered part of the unicast request proper.
</p>
<h5 class="Heading4">
  <a name="42796"> </a>DJ.2.6.7	 Protocol Version 2 Response Format
</h5>
<p class="Body">
  <a name="42824"> </a>The table below describes the contents of a protocol version 2 unicast response.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="42801"> </a><div class="CellHeading">Count</div></th>
    <th><a name="42803"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="42805"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="42807"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42809"> </a><code>int</code><br>
</div>
</td>
    <td><a name="42811"> </a><div class="CellBody">protocol version</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42813"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42815"> </a><code>long</code><br>
</div>
</td>
    <td><a name="42817"> </a><div class="CellBody">selected format ID</div></td>
  </tr>
  <tr>
    <td><a name="42819"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42821"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="42823"> </a><div class="CellBody">discovery format data</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="42861"> </a>Packet contents consist of a contiguous series of values in the order listed above from top to bottom. Values of type <code>byte</code>, <code>int</code>, and <code>long</code> are encoded in the formats specified for the <code>writeByte</code>, <code>writeInt</code>, and <code>writeLong</code> methods of the <code>java.io.DataOutput</code> interface, respectively. Discovery format data encompasses all data sent after the end of the discovery format ID, until the connection is closed. If the format ID is the null format ID, then the discovery format data must not be present. Otherwise, the discovery format data must include at least the following values, described in <a href="#42618">Section DJ.2.6.3, "Unicast Response Contents"</a>:
</p>
<ul>

  <li class="SmartList1"><a name="42868"> </a>Registrar proxy
  <li class="SmartList1"><a name="42869"> </a>Member groups
  <li class="SmartList1"><a name="42870"> </a>Unicast discovery host
  <li class="SmartList1"><a name="42871"> </a>Unicast discovery port
</ul>

<p class="Body">
  <a name="42862"> </a>Note that the selected discovery format may also call for the discovering entity to send discovery format data, such as authentication information, to the lookup service.
</p>
<h5 class="Heading4">
  <a name="42797"> </a>DJ.2.6.8	 Protocol Version 2 Discovery Format Negotiation
</h5>
<p class="Body">
  <a name="42880"> </a>In version 2 of the unicast discovery protocol, unicast requests carry lists of discovery format IDs representing proposed discovery formats. When a lookup service supporting version 2 of the unicast discovery protocol receives such a request, it should iterate through the list of proposed discovery formats until it encounters a discovery format that it supports. It should then include the discovery format ID for this format as the selected format ID in the response it sends back to the discovering entity, and encode/decode all subsequent data transmitted over the connection according to the selected format. If none of the proposed discovery formats is acceptable, the lookup service must write the null discovery format ID as the selected format ID in its response.
</p>
<h3 class="Heading2">
  <a name="19455"> </a>DJ.3	 Standard Discovery Formats
</h3>
<p class="Body">
  <a name="42924"> </a>This section specifies a set of standard discovery formats to be used with version 2 of the multicast request, multicast announcement, and unicast discovery protocols. The discovery formats presented here should not preclude the creation or use of other discovery formats; rather, they are provided in order to serve as an initial baseline for interoperability.
</p>
<h4 class="Heading3">
  <a name="42916"> </a>DJ.3.1	 The <code>net.jini.discovery.plaintext</code> Format
</h4>
<p class="Body">
  <a name="42930"> </a>The <code>net.jini.discovery.plaintext</code> format specifies plaintext encodings for discovery format data. It does not provide encryption or integrity protection of the discovery format data. It applies to the multicast request, multicast announcement, and unicast discovery protocols. The discovery format ID for this format is <code>8507042184704347702</code>.
</p>
<h5 class="Heading4">
  <a name="42932"> </a>DJ.3.1.1	 Multicast Requests
</h5>
<p class="Body">
  <a name="42947"> </a>The table below illustrates the layout for multicast request discovery format data specified by the <code>net.jini.discovery.plaintext</code> discovery format. The values to encode are described in <a href="#41882">Section DJ.2.4.5, "Protocol Version 2 Request Packet Format"</a>.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="42963"> </a><div class="CellHeading">Count</div></th>
    <th><a name="42965"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="42967"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="42969"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42971"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="42973"> </a><div class="CellBody">multicast response host</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42975"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42977"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="42979"> </a><div class="CellBody">multicast response port</div></td>
  </tr>
  <tr>
    <td align="right"><a name="42981"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42983"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="42985"> </a><div class="CellBody">group count</div></td>
  </tr>
  <tr>
    <td><a name="42987"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="42989"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="42991"> </a><div class="CellBody">requested groups</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43143"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43145"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="43147"> </a><div class="CellBody">service ID count</div></td>
  </tr>
  <tr>
    <td><a name="43151"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43153"> </a><code>net.jini.core.lookup.ServiceID</code><br>
</div>
</td>
    <td><a name="43155"> </a><div class="CellBody">heard lookup service IDs</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="42933"> </a>The discovery format data consists of a contiguous series of values in the order listed above from top to bottom. Values of type <code>String</code> are encoded in the format specified for the <code>writeUTF</code> method of the <code>java.io.DataOutput</code> interface. Unsigned <code>short</code> values are encoded as if they were cast to signed <code>short</code> values, and then written in the format specified for the <code>writeShort</code> method of the <code>java.io.DataOutput</code> interface. Values of type <code>ServiceID</code> are encoded in the format specified for the <code>ServiceID.writeBytes</code> method. The number of group strings written must be equal to the group count value. The number of service IDs written must be equal to the service ID count value.
</p>
<h5 class="Heading4">
  <a name="43197"> </a>DJ.3.1.2	 Multicast Announcements
</h5>
<p class="Body">
  <a name="43198"> </a>The table below illustrates the layout for multicast announcement discovery format data specified by the <code>net.jini.discovery.plaintext</code> discovery format. The values to encode are described in <a href="#42026">Section DJ.2.5.1, "Announcement Packet Contents"</a>.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="43271"> </a><div class="CellHeading">Count</div></th>
    <th><a name="43273"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="43275"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="43277"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43279"> </a><code>long</code><br>
</div>
</td>
    <td><a name="43281"> </a><div class="CellBody">sequence number</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43283"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43285"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="43287"> </a><div class="CellBody">unicast discovery host</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43289"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43291"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="43293"> </a><div class="CellBody">unicast discovery port</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43317"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43319"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="43321"> </a><div class="CellBody">group count</div></td>
  </tr>
  <tr>
    <td><a name="43295"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43297"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="43299"> </a><div class="CellBody">member groups</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43301"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43303"> </a><code>net.jini.core.lookup.ServiceID</code><br>
</div>
</td>
    <td><a name="43305"> </a><div class="CellBody">lookup service ID</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="43332"> </a>The discovery format data consists of a contiguous series of values in the order listed above from top to bottom. Values of type <code>long</code> and <code>String</code> are encoded in the formats specified for the <code>writeLong</code> and <code>writeUTF</code> methods of the <code>java.io.DataOutput</code> interface, respectively. Unsigned <code>short</code> values are encoded as if they were cast to signed <code>short</code> values, and then written in the format specified for the <code>writeShort</code> method of the <code>java.io.DataOutput</code> interface. The <code>ServiceID</code> value is encoded in the format specified for the <code>ServiceID.writeBytes</code> method. The number of group strings written must be equal to the group count value.
</p>
<h5 class="Heading4">
  <a name="42942"> </a>DJ.3.1.3	 Unicast Responses
</h5>
<p class="Body">
  <a name="43346"> </a>The table below illustrates the layout for unicast response discovery format data specified by the <code>net.jini.discovery.plaintext</code> discovery format. The values to encode are described in <a href="#42618">Section DJ.2.6.3, "Unicast Response Contents"</a>.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="43352"> </a><div class="CellHeading">Count</div></th>
    <th><a name="43354"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="43356"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="43364"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43366"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="43368"> </a><div class="CellBody">unicast discovery host</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43370"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43372"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="43374"> </a><div class="CellBody">unicast discovery port</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43376"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43378"> </a>unsigned <code>short</code><br>
</div>
</td>
    <td><a name="43380"> </a><div class="CellBody">group count</div></td>
  </tr>
  <tr>
    <td><a name="43382"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43384"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="43386"> </a><div class="CellBody">member groups</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43388"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43390"> </a><code>net.jini.io.MarshalledInstance</code><br>
</div>
</td>
    <td><a name="43392"> </a><div class="CellBody">registrar proxy</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="43653"> </a>The discovery format data consists of a contiguous series of values in the order listed above from top to bottom. Values of type <code>String</code> are encoded in the format specified for the <code>writeUTF</code> method of the <code>java.io.DataOutput</code> interface. Unsigned <code>short</code> values are encoded as if they were cast to signed <code>short</code> values, and then written in the format specified for the <code>writeShort</code> method of the <code>java.io.DataOutput</code> interface. The registrar proxy is written in the same format that would be produced by constructing a <code>java.io.ObjectOutputStream</code>, and writing to it an instance of <code>net.jini.io.MarshalledInstance</code> containing the marshalled registrar proxy. The number of group strings written must be equal to the group count value.
</p>
<h4 class="Heading3">
  <a name="43655"> </a>DJ.3.2	 The <code>net.jini.discovery.x500.SHA1withDSA</code> Format
</h4>
<p class="Body">
  <a name="43656"> </a>The <code>net.jini.discovery.x500.SHA1withDSA</code> format extends the multicast request and announcement encodings specified by the <code>net.jini.discovery.plaintext</code> format (see Sections <a href="#42932">DJ.3.1.1</a> and <a href="#43197">DJ.3.1.2</a>), appending to each an authentication block containing the X.500 distinguished name of the sender coupled with the sender's DSA signature of all data in the packet up to, but not including, the authentication block. This discovery format thus supports integrity protection of multicast request and announcement packet contents, and sender authentication. It does not, however, support encryption of packet contents, nor does it apply to the unicast discovery protocol. The discovery format ID for this format is <code>-4239414871821148892</code>.
</p>
<h5 class="Heading4">
  <a name="43448"> </a>DJ.3.2.1	 Multicast Requests
</h5>
<p class="Body">
  <a name="43455"> </a>The table below illustrates the layout for multicast request discovery format data specified by the <code>net.jini.discovery.x500.SHA1withDSA</code> discovery format.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="43461"> </a><div class="CellHeading">Count</div></th>
    <th><a name="43463"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="43465"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="43467"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43469"> </a><code>int</code><br>
</div>
</td>
    <td><a name="43471"> </a><div class="CellBody">plaintext data length</div></td>
  </tr>
  <tr>
    <td><a name="43485"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43487"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="43489"> </a><div class="CellBody">plaintext data</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43491"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43493"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="43495"> </a><div class="CellBody">sender X.500 distinguished name</div></td>
  </tr>
  <tr>
    <td><a name="43497"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43499"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="43501"> </a><div class="CellBody">sender DSA signature</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="43568"> </a>The discovery format data consists of a contiguous series of values in the order listed above from top to bottom. Values of type <code>int</code> and <code>String</code> are encoded in the formats specified for the <code>writeInt</code> and <code>writeUTF</code> methods of the <code>java.io.DataOutput</code> interface, respectively. The variable-length plaintext data referenced in the table above consists of the following values encoded according to the <code>net.jini.discovery.plaintext</code> discovery format for multicast requests, specified in <a href="#42932">Section DJ.3.1.1</a>:
</p>
<ul>

  <li class="SmartList1"><a name="43572"> </a>Multicast response host
  <li class="SmartList1"><a name="43548"> </a>Multicast response port
  <li class="SmartList1"><a name="43553"> </a>Requested groups
  <li class="SmartList1"><a name="43554"> </a>Heard lookup service IDs
</ul>

<p class="Body">
  <a name="43555"> </a>The length of the <code>net.jini.discovery.plaintext</code> formatted data is indicated by the plaintext data length value immediately preceding it. The sender X.500 distinguished name is formatted in the string representation specified by <em class="Emphasis">RFC 2253</em>. The sender DSA signature is encoded according to the specification for the <code>SHA1withDSA</code> signature algorithm in Appendix B of the <em class="Emphasis">Java Cryptography Architecture API Specification &amp; Reference</em>, which is based on <em class="Emphasis">Federal Information Processing Standards Publication (FIPS PUB) 186</em>. The signature applies to all data from the start of the multicast request packet up to, but not including, the sender X.500 distinguished name.
</p>
<h5 class="Heading4">
  <a name="43449"> </a>DJ.3.2.2	 Multicast Announcements
</h5>
<p class="Body">
  <a name="43584"> </a>The table below illustrates the layout for multicast announcement discovery format data specified by the <code>net.jini.discovery.x500.SHA1withDSA</code> discovery format.
<p>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><a name="43587"> </a><div class="CellHeading">Count</div></th>
    <th><a name="43589"> </a><div class="CellHeading">Data Type</div></th>
    <th><a name="43591"> </a><div class="CellHeading">Description</div></th>
  </tr>
  <tr>
    <td align="right"><a name="43593"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: justify; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43595"> </a><code>int</code><br>
</div>
</td>
    <td><a name="43597"> </a><div class="CellBody">plaintext data length</div></td>
  </tr>
  <tr>
    <td><a name="43599"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43601"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="43603"> </a><div class="CellBody">plaintext data</div></td>
  </tr>
  <tr>
    <td align="right"><a name="43605"> </a><div class="CellBody">1</div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43607"> </a><code>java.lang.String</code><br>
</div>
</td>
    <td><a name="43609"> </a><div class="CellBody">sender X.500 distinguished name</div></td>
  </tr>
  <tr>
    <td><a name="43611"> </a><div class="CellBody"><em class="Emphasis">variable</em></div></td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43613"> </a><code>byte</code><br>
</div>
</td>
    <td><a name="43615"> </a><div class="CellBody">sender DSA signature</div></td>
  </tr>
</table>




</p>
<p class="Body">
  <a name="43616"> </a>The discovery format data consists of a contiguous series of values in the order listed above from top to bottom. Values of type <code>int</code> and <code>String</code> are encoded in the formats specified for the <code>writeInt</code> and <code>writeUTF</code> methods of the <code>java.io.DataOutput</code> interface, respectively. The variable-length plaintext data referenced in the table above consists of the following values encoded according to the <code>net.jini.discovery.plaintext</code> discovery format for multicast announcements, specified in <a href="#43197">Section DJ.3.1.2</a>:
</p>
<ul>

  <li class="SmartList1"><a name="43620"> </a>Sequence number
  <li class="SmartList1"><a name="43621"> </a>Unicast discovery host
  <li class="SmartList1"><a name="43622"> </a>Unicast discovery port
  <li class="SmartList1"><a name="43642"> </a>Member groups
  <li class="SmartList1"><a name="43623"> </a>Lookup service ID
</ul>

<p class="Body">
  <a name="43582"> </a>The length of the <code>net.jini.discovery.plaintext</code> formatted data is indicated by the plaintext data length value immediately preceding it. The sender X.500 distinguished name is formatted in the string representation specified by <em class="Emphasis">RFC 2253</em>. The sender DSA signature is encoded according to the specification for the <code>SHA1withDSA</code> signature algorithm in Appendix B of the <em class="Emphasis">Java Cryptography Architecture API Specification &amp; Reference</em>, which is based on <em class="Emphasis">Federal Information Processing Standards Publication (FIPS PUB) 186</em>. The signature applies to all data from the start of the multicast announcement packet up to, but not including, the sender X.500 distinguished name.
</p>
<h4 class="Heading3">
  <a name="43441"> </a>DJ.3.3	 The <code>net.jini.discovery.x500.SHA1withRSA</code> Format
</h4>
<p class="Body">
  <a name="43665"> </a>The <code>net.jini.discovery.x500.SHA1withRSA</code> format is nearly identical to the <code>net.jini.discovery.x500.SHA1withDSA</code> format specified in <a href="#43655">Section DJ.3.2</a>, except that it uses RSA encryption for signing data, instead of DSA. Signatures are encoded according to the specification for the <code>SHA1withRSA</code> signature algorithm in Appendix B of the <em class="Emphasis">Java Cryptography Architecture API Specification &amp; Reference</em>. In all other respects, the two formats are the same. The discovery format ID for this format is -248696397102000882.
</p>
<h4 class="Heading3">
  <a name="42919"> </a>DJ.3.4	 The <code>net.jini.discovery.ssl</code> Format
</h4>
<p class="Body">
  <a name="43677"> </a>The <code>net.jini.discovery.ssl</code> format specifies an encoding in which unicast response data is sent across a TLS/SSL (Transport Layer Security/Secure Socket Layer) connection. Encryption, authentication, and/or integrity protection may be provided by the underlying TLS/SSL connection, depending on the selected cipher suite. This discovery format does not apply to multicast requests or announcements. The discovery format ID for this format is <code>1816474798606646324</code>. TLS/SSL is specified in <em class="Emphasis">RFC 2246</em>.
</p>
<h5 class="Heading4">
  <a name="43681"> </a>DJ.3.4.1	 Unicast Responses
</h5>
<p class="Body">
  <a name="43682"> </a>In the <code>net.jini.discovery.ssl</code> format, transmission of unicast response data involves three steps:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="43686"> </a>The discovering entity establishes a TLS/SSL connection between itself and the lookup service on top of the TCP connection over which it sent the unicast request.
      <li class="SmartList3" value="2"><a name="43696"> </a>The discovering entity transmits a hash of all of the data it has sent and received over the connection so far.
      <li class="SmartList3" value="3"><a name="43697"> </a>The lookup service also computes a hash of all of the data it has received and sent over the connection so far. If this hash value matches that sent by the discovering entity, then the lookup service sends the unicast response data encoded as described later in this section. If the hash does not match, the lookup service terminates the connection.
    </ol>
<p class="Body">
  <a name="43707"> </a>The hash sent by the discovering entity to the lookup service is computed as follows: first, a sequence of bytes is assembled consisting of the entire unicast request immediately followed by the portion of the unicast response that is not discovery format data--the initial protocol version followed by the selected format ID, as specified in <a href="#42796">Section DJ.2.6.7, "Protocol Version 2 Response Format"</a>. This sequence of bytes is then used as input to the SHA-1 hash function; the 160-bit result is sent in its entirety in big-endian order as the hash value. The SHA-1 hash function is specified in <em class="Emphasis">Federal Information Processing Standards Publication (FIPS PUB) 180-1</em>.
</p>
<p class="Body">
  <a name="43722"> </a>The unicast response data sent by the lookup service, if the hashes match, consists of the following values encoded (on top of the secured TLS/SSL connection) according to the <code>net.jini.discovery.plaintext</code> discovery format for unicast responses, specified in <a href="#42942">Section DJ.3.1.3</a>:
</p>
<ul>

  <li class="SmartList1"><a name="43729"> </a>Unicast discovery host
  <li class="SmartList1"><a name="43730"> </a>Unicast discovery port
  <li class="SmartList1"><a name="43731"> </a>Member groups
  <li class="SmartList1"><a name="43732"> </a>Registrar proxy
</ul>

<h4 class="Heading3">
  <a name="43699"> </a>DJ.3.5	 The <code>net.jini.discovery.kerberos</code> Format
</h4>
<p class="Body">
  <a name="43750"> </a>The <code>net.jini.discovery.kerberos</code> format specifies an encoding in which unicast response data is sent across a connection secured using the Kerberos Version 5 GSS-API Mechanism, defined in <em class="Emphasis">RFC 1964</em>. Kerberos provides authentication; encryption and integrity protection of the transmitted data may also be provided depending on the GSS-API context in use for the connection. This discovery format does not apply to multicast requests or announcements. The discovery format ID for this format is <code>5724038453852586603</code>. The Kerberos network authentication protocol is defined in <em class="Emphasis">RFC 1510</em>; the GSS-API is defined in <em class="Emphasis">RFC 2743</em>.
</p>
<h5 class="Heading4">
  <a name="43758"> </a>DJ.3.5.1	 Unicast Responses
</h5>
<p class="Body">
  <a name="43761"> </a>Transmission of unicast response data in the <code>net.jini.discovery.kerberos</code> discovery format is similar to the <code>net.jini.discovery.ssl</code> format, except that the underlying connection is secured using the Kerberos Version 5 GSS-API Mechanism instead of TLS/SSL:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="43764"> </a>The discovering entity establishes a GSS-API context for communicating with the lookup service, whose Kerberos principal it knows in advance. It then uses GSS-API tokens obtained from the established context to wrap all subsequent data sent to the lookup service (over the TCP connection on which the unicast request was originally transmitted). Also, all data subsequently received over the connection is unwrapped using the GSS-API.
      <li class="SmartList3" value="2"><a name="43765"> </a>The discovering entity transmits a hash of all of the data it has sent and received over the connection so far. Multiple GSS-API tokens may be used to convey the hash. The hash is computed as specified in <a href="#43681">Section DJ.3.4.1</a>
      <li class="SmartList3" value="3"><a name="43766"> </a>The lookup service also computes a hash of all of the data it has received and sent over the connection so far. If this hash value matches that sent by the discovering entity, then the lookup service sends the unicast response data, encoded as specified in <a href="#43681">Section DJ.3.4.1</a>, over the TCP connection to the discovering entity, using GSS-API tokens as described in step 1. Multiple GSS-API tokens may be used to convey the unicast response data.
    </ol>
<h3 class="Heading2">
  <a name="43752"> </a>DJ.4	 The Join Protocol	 
</h3>
<p class="Body">
  <a name="19465"> </a>Having covered the discovery protocols, we continue on to describe the join protocol. This protocol makes use of the discovery protocols to provide a standard sequence of steps that services should perform when they are starting up and registering themselves with a lookup service.
</p>
<h4 class="Heading3">
  <a name="19466"> </a>DJ.4.1	 Persistent State
</h4>
<p class="Body">
  <a name="19467"> </a>A service must maintain certain items of state across restarts and crashes. These items are as follows:
</p>
<ul>

  <li class="SmartList1"><a name="19468"> </a>Its service ID. A new service will not have been assigned a service ID, so this will be not be set when a service is started for the first time. After a service has been assigned a service ID, it must continue to use it across all lookup services.
  <li class="SmartList1"><a name="19469"> </a>A set of attributes that describe the service's lookup service entry.
  <li class="SmartList1"><a name="40251"> </a>A set of groups in which the service wishes to participate. For most services this set will initially contain a single entry: the empty string (which denotes the public group).
  <li class="SmartList1"><a name="19471"> </a>A set of specific lookup services to register with. This set will usually be empty for new services.
</ul>

<p class="Body">
  <a name="19472"> </a>Note that by "new service" here, we mean one that has never before been started, not one that is being started again or one that has been moved from one network to another.
</p>
<h4 class="Heading3">
  <a name="19473"> </a>DJ.4.2	 The Join Protocol
</h4>
<p class="Body">
  <a name="19474"> </a>When a service initially starts up, it should pause a random amount of time (up to 15 seconds is a reasonable range). This will reduce the likelihood of a packet storm occurring if power is restored to a network segment that houses a large number of services.
</p>
<h5 class="Heading4">
  <a name="19475"> </a>DJ.4.2.1	 Initial Discovery and Registration
</h5>
<p class="Body">
  <a name="19476"> </a>For each member of the set of specific lookup services to register with, the service attempts to perform unicast discovery of each one and to register with each one. If any fails to respond, the implementor may choose to either retry or give up, but the non-responding lookup service should not be automatically removed from the set if an implementation decides to give up.
</p>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: normal; font-weight: bold; margin-bottom: 8pt; margin-left: 36pt; margin-right: 0pt; margin-top: 13pt; text-align: left; text-decoration: none; text-indent: -36pt; text-transform: none; vertical-align: baseline">
<a name="19477"> </a>Joining Groups<br>
</div>
<p class="Body">
  <a name="19478"> </a>If the set of groups to join is not empty, the service performs multicast discovery and registers with each of the lookup services that either respond to requests or announce themselves as members of one or more of the groups the service should join.
</p>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: normal; font-weight: bold; margin-bottom: 8pt; margin-left: 36pt; margin-right: 0pt; margin-top: 13pt; text-align: left; text-decoration: none; text-indent: -36pt; text-transform: none; vertical-align: baseline">
<a name="19479"> </a>Order of Discovery<br>
</div>
<p class="Body">
  <a name="40256"> </a>The unicast and multicast discovery steps detailed above do not need to proceed in any strict sequence. The registering service must register the same sets of attributes with each lookup service, and must use a single service ID across all registrations. 
</p>
<h5 class="Heading4">
  <a name="19481"> </a>DJ.4.2.2	 Lease Renewal and Handling of Communication Problems
</h5>
<p class="Body">
  <a name="19482"> </a>Once a service has registered with a lookup service, it periodically renews the lease on its registration. A lease with a particular lookup service is cancelled only if the registering service is instructed to unregister itself.
</p>
<p class="Body">
  <a name="19483"> </a>If a service cannot communicate with a particular lookup service, the action it takes depends on its relation to that lookup service. If the lookup service is in the persistent set of specific lookup services to join, the service must attempt to reregister with that lookup service. If the lookup service was discovered using multicast discovery, it is safe for the registering service to forget about it and await a subsequent multicast announcement.
</p>
<h5 class="Heading4">
  <a name="19484"> </a>DJ.4.2.3	 Making Changes and Performing Updates
</h5>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: normal; font-weight: bold; margin-bottom: 8pt; margin-left: 36pt; margin-right: 0pt; margin-top: 13pt; text-align: left; text-decoration: none; text-indent: -36pt; text-transform: none; vertical-align: baseline">
<a name="19485"> </a>Attribute Modification<br>
</div>
<p class="Body">
  <a name="19486"> </a>If a service is asked to change the set of attributes with which it registers itself, it saves the changed set in a persistent store, then performs the requested change at each lookup service with which it is registered.
</p>
<div style="color: #000000; font-family: Times; font-size: 11pt; font-style: normal; font-weight: bold; margin-bottom: 8pt; margin-left: 36pt; margin-right: 0pt; margin-top: 13pt; text-align: left; text-decoration: none; text-indent: -36pt; text-transform: none; vertical-align: baseline">
<a name="19487"> </a>Registering and Unregistering with Lookup Services<br>
</div>
<p class="Body">
  <a name="19488"> </a>If a service is asked to register with a specific lookup service, it adds that lookup service to the persistent set of lookup services it should join, and then registers itself with that lookup service as detailed above.
</p>
<p class="Body">
  <a name="19489"> </a>If a service is asked to unregister from a specific lookup service and that service is in the persistent set of lookup services to join, it should be removed from that set. Whether or not this step needs to be taken, the service cancels the leases for all entries it maintains at that lookup service.
</p>
<h5 class="Heading4">
  <a name="19490"> </a>DJ.4.2.4	 Joining or Leaving a Group
</h5>
<p class="Body">
  <a name="19491"> </a>If a service is asked to join a group, it adds the name of that group to the persistent set of groups to join and either starts or continues to perform multicast discovery using this augmented group.
</p>
<p class="Body">
  <a name="19492"> </a>If the service is requested to leave a group, the steps are a little more complex:
</p>
<ol type="1">
      <li class="SmartList3" value="1"><a name="19493"> </a>It removes that group from the persistent set of groups to join.
      <li class="SmartList3" value="2"><a name="19494"> </a>It removes all lookup services that match only that group in the set of groups it is interested in from the set it has discovered using multicast discovery, and unregisters from those lookup services.
      <li class="SmartList3" value="3"><a name="19495"> </a>It either continues to perform multicast discovery with the reduced set of groups or, if the set has been reduced to empty, ceases multicast discovery.
    </ol>
<h3 class="Heading2">
  <a name="19561"> </a>DJ.5	 Network Issues	 
</h3>
<p class="Body">
  <a name="19562"> </a>Now we will discuss various issues that pertain to the multicast network protocol used by the multicast discovery service. Much of the discussion centers on the Internet protocols, as the lookup discovery protocol is expected to be most heavily used on IP-based internets and intranets.
</p>
<h4 class="Heading3">
  <a name="19563"> </a>DJ.5.1	 Properties of the Underlying Transport
</h4>
<p class="Body">
  <a name="19564"> </a>The network protocol that is used to communicate between a discovering entity and an instance of the discovery request service is assumed to be unreliable and connectionless, and to provide unordered delivery of packets.
</p>
<p class="Body">
  <a name="19565"> </a>This maps naturally onto both IP multicast and local-area IP broadcast, but should work equally well with connection-oriented reliable multicast protocols.
</p>
<h5 class="Heading4">
  <a name="19566"> </a>DJ.5.1.1	 Limiting Packet Sizes
</h5>
<p class="Body">
  <a name="19567"> </a>Since we assume that the underlying transport does not necessarily deliver packets in order, we must address this fact. Although we could mandate that request packets contain sequence numbers, such that they could be reassembled in order by instances of the discovery request service, this seems excessive. Instead, we recommend that discovery requests not exceed 512 bytes in size, including headers for lower-level protocols. This squeaks in below the lowest required <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">MTU</span> size that is required to be supported by IP implementations.
</p>
<h4 class="Heading3">
  <a name="19568"> </a>DJ.5.2	 Bridging Calls to the Discovery Request Service
</h4>
<p class="Body">
  <a name="19569"> </a>Whether or not calls to the discovery request service will need to be bridged across <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">LAN</span> or wide area network (<span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">WAN</span>) segments will depend on the network protocol being used and the topology of the local network.
</p>
<p class="Body">
  <a name="19570"> </a>In an environment in which every <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">LAN</span> segment happens to host a Jini lookup service, bridging might not be necessary. This does not seem likely to be a typical scenario.
</p>
<p class="Body">
  <a name="19571"> </a>Where the underlying transport is multicast IP, intelligent bridges and routers must be able to forward packets appropriately. This simply requires that they support one of the multicast IP routing protocols; most router vendors already do so.
</p>
<p class="Body">
  <a name="19572"> </a>If the underlying transport were permitted to be local-area IP broadcast, some kind of intelligent broadcast relay would be required, similar to that described in the <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">DHCP</span> and <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">BOOTP</span> specifications. Since this would increase the complexity of the infrastructure needed to support the Jini discovery protocol, we mandate use of multicast IP instead of broadcast IP.
</p>
<h4 class="Heading3">
  <a name="19573"> </a>DJ.5.3	 Limiting the Scope of Multicasts
</h4>
<p class="Body">
  <a name="19574"> </a>In an environment that makes use of IP multicast or a similar protocol, the joining entity should restrict the scope of the multicasts it makes by setting the time-to-live (<span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TTL</span>) field of outgoing packets appropriately. The value of the <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TTL</span> field is not mandated, but we recommend that it be set to 15.
</p>
<h4 class="Heading3">
  <a name="19575"> </a>DJ.5.4	 Using Multicast IP as the Underlying Transport
</h4>
<p class="Body">
  <a name="19576"> </a>If multicast IP is being used as the underlying transport, request packets are encapsulated using <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">UDP</span> (checksums must be enabled). A combination of a well-known multicast IP address and a well-known <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">UDP</span> port is used by instances of the discovery request service and joining entities.
</p>
<h4 class="Heading3">
  <a name="19577"> </a>DJ.5.5	 Address and Port Mappings for TCP and Multicast UDP
</h4>
<p class="Body">
  <a name="19461"> </a>The port number for Jini lookup discovery requests is <code>4160</code>. This applies to both the multicast and unicast discovery protocols. For multicast discovery the IP address of the multicast group over which discovery requests should travel is <code>224.0.1.85</code>. Multicast announcements should use the address <code>224.0.1.84</code>.
</p>
<p class="Body">
  <a name="19635"> </a>
</p>
<h3 class="Heading2">
  <a name="19639"> </a>DJ.6	 <code>LookupLocator</code> Class	 
</h3>
<p class="Body">
  <a name="19640"> </a>The <code>LookupLocator</code> class provides a simple interface for performing unicast discovery, using version 1 of the unicast discovery protocol:
</p>
<blockquote>
<pre  class="Preformatted">
<a name="39425"></a>package net.jini.core.discovery;

import java.io.IOException;
import java.io.Serializable;
import java.net.MalformedURLException;
import net.jini.core.lookup.ServiceRegistrar;

public class LookupLocator implements Serializable {

    protected String host;
    protected int port;
    
public LookupLocator(String host, int port) {...}
    public LookupLocator(String url)
        throws MalformedURLException {...}
    public String getHost() {...}
    public int getPort() {...}
    public ServiceRegistrar getRegistrar()
        throws IOException, ClassNotFoundException {...}
    public ServiceRegistrar getRegistrar(int timeout)
        throws IOException, ClassNotFoundException {...}
}
</pre>
</blockquote>
<p class="Body">
  <a name="19660"> </a>Each constructor takes parameters that allow the object to determine what IP address and <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP</span> port number it should connect to. 
</p>
<p class="Body">The first constructor takes a host name and port number. It throws an <code>IllegalArgumentException</code> if the port number is not between 1 and 65535 (both included). It also throws an <code>IllegalArgumentException</code> if the <code>host</code> cannot be parsed according to any one of the following syntactical requirements:
<ul>

  <li class="SmartList1">A <code>host</code> as required by a <em>server-based naming authority</em> in section 3.2.2 of RFC 2396. This RFC defines the generic syntax for Uniform Resource Identifiers (URIs). 
  <li class="SmartList1">A literal IPv6 address as defined by RFC 2732
  <li class="SmartList1">A literal IPv6 address as defined by RFC 3513
</ul>
It throws a <code>NullPointerException</code> if the host name is <code>null</code>. On completion, the <code>host</code> and <code>port</code> fields are assigned the values of the input <code>host</code> and <code>port</code> parameters.
</p>
<p class="Body">The second constructor takes a URL of scheme <code>"jini"</code> as defined in section DJ.6.1. It throws a <code>MalformedURLException</code> if the URL is invalid and a <code>NullPointerException</code> if the URL is <code>null</code>. On completion, the <code>host</code> and <code>port</code> fields are assigned the <code>host</code> and <code>port</code> components of the input URL. If no port is specified in the URL, the default value of <code>4160</code> specified in section DJ.6.1 is assumed.
</p>
<p class="Body">Neither constructor performs the unicast discovery protocol, nor does either resolve the host name passed as argument.
  
  
</p>
<p class="Body">
  <a name="19661"> </a>The <code>getHost</code> method returns the <code>host</code> field, which is the name of the host with which this object attempts to perform unicast discovery. The <code>getPort</code> method returns the <code> port</code> field, which is the <span style="color: #000000; font-size: 10pt; font-style: normal; font-weight: normal; text-decoration: none; text-transform: none; vertical-align: baseline">TCP</span> port at the host to which this object connects. 
</p>

<p class="Body">The <code>equals</code> method returns <code>true</code> if both instances have the same <code>host</code> and <code>port</code> fields. The case of the <code>host</code> is ignored. Alternative forms of the same IPv6 address for the <code>host</code> value are treated as being unequal.
<
p class="Body">The <code>hashCode</code> method returns a hash value calculated from the values of the <code>host</code> and <code>port</code> fields.
<p class="Body">
  <a name="19662"> </a>There are two forms of the <code>getRegistrar</code> method. Each performs unicast discovery and returns an instance of the proxy for the specified lookup service, or throws either an <code>IOException</code> or a <code>ClassNotFoundException</code> if a problem occurs during the discovery protocol. Each method performs unicast discovery every time it is called, connecting to a host and port determined by the values of the <code>host</code> and <code>port</code> fields respectively. If the host name for this object resolves to multiple IP addresses, it is assumed that a lookup service for the same djinn lives at each address.
</p>
<p class="Body">
  <a name="19663"> </a>The form of this method that takes a <code>timeout</code> parameter will throw a <code>java.io.InterruptedIOException</code> if it blocks for more than <code>timeout</code> milliseconds while waiting for a response. A value of 0 specifies an infinite timeout and a negative value causes this method to throw an <code>IllegalArgumentException</code>.
<p class="Body">
A similar timeout is implied for the no-arg form of this method. It invokes the one-arg form of the method, passing to it a timeout value. The timeout in milliseconds may be specified globally using the <code>net.jini.discovery.timeout</code> system property. A default equal to 60 seconds is assumed if the system property is not set, set to a negative value, or cannot be parsed as an <code>Integer</code>.
</p>
<h4 class="Heading3">
  <a name="19664"> </a>DJ.6.1	 Jini Technology URL Syntax
</h4>
<p class="Body">
  <a name="19665"> </a>The syntax of the Jini technology URL is that of a <em>hierarchical</em> URI with a <em>server-based naming authority</em> (host and optional port). The URI syntax is defined in RFC 2396. The components of the URL must satisfy the following requirements:
</p>
<ul>

  <li class="SmartList1">A <em>scheme</em> of <code>"jini"</code> must be present.
  <li class="SmartList1">A <em>server-based naming authority</em> must be present; <em>user-info</em> must not be present. The <em>port</em>, if present, must be between 1 and 65535 (both included).
  <li class="SmartList1">A <em>path</em> if present, must be <code>"/"</code>; path segments must not be present.
  <li class="SmartList1">There must not be any other components present.
  </ul>
  
If no port number is specified, the default is 4160.<a href="#40289"><sup>2</sup></a><a name="40286"></a>
<p class="Body">
Four possible forms of the URL are: 
<ul>
  <li class="SmartList1"><code>jini://host</code>
  <li class="SmartList1"><code>jini://host/</code>
  <li class="SmartList1"><code>jini://host:port</code>
  <li class="SmartList1"><code>jini://host:port/</code>
</ul>


<h4 class="Heading3">
  <a name="43969"> </a>DJ.6.2	 Serialized Form
</h4>
<p>

<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th><div style="color: #000000; font-family: Times; font-size: 9pt; font-style: normal; font-weight: bold; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 7pt; text-transform: none; vertical-align: baseline">
<a name="43973"> </a>Class<br>
</div>
</th>
    <th><div style="color: #000000; font-family: Times; font-size: 9pt; font-style: normal; font-weight: bold; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 7pt; text-transform: none; vertical-align: baseline">
<a name="43975"> </a><code>serialVersionUID</code><br>
</div>
</th>
    <th><div style="color: #000000; font-family: Times; font-size: 9pt; font-style: normal; font-weight: bold; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 7pt; text-transform: none; vertical-align: baseline">
<a name="43977"> </a>Serialized Fields<br>
</div>
</th>
  </tr>
  <tr>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43979"> </a><code>LookupLocator</code><br>
</div>
</td>
    <td><div style="color: #000000; font-family: Times; font-size: 9pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 7pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: baseline">
<a name="43981"> </a>1448769379829432795L<br>
</div>
</td>
    <td><div style="color: #000000; font-family: Lucida Sans Typewriter; font-size: 11pt; font-style: normal; font-weight: normal; margin-bottom: 0pt; margin-left: 0pt; margin-right: 0pt; margin-top: 0pt; text-align: left; text-decoration: none; text-indent: 0pt; text-transform: none; vertical-align: sub">
<a name="43983"> </a><code>String host<br>int port</code><br>
</div>
</td>
  </tr>
</table>




</p>
<h3 class="Heading2">
  <a name="43987"> </a>DJ.7	 History </h3>
<p>
<table align="center" border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000" cellpadding="5" cellspacing="0" summary="changes made to this specification">
  <caption><p class="Body">
  <a name="01887"> </a>
</p>
</caption>
  <tr bgcolor="#CCCCCC">
    <th>Version</th>
    <th>Description</th>
  </tr>
   <tr>
    <td valign="top">v1.0
	</td>
    <td>Initial release of this specification.</td>
  </tr>
  <tr>
    <td valign="top">v2.0
	</td>
    <td>Add specification of version 2 of the multicast request, multicast announcement, and unicast discovery protocols.<br>
Add specification of standard discovery formats for version 2 of the discovery protocols.<br>
Change the 512-byte size limit for multicast packet contents from a requirement to a recommendation.<br>
Miscellaneous corrections.<br>

</td>
  </tr>
  <tr>
    <td valign="top">v3.0
	</td>
    <td>Correct specification for the computation of Discovery Format IDs.<br>
    Clarify Jini Technology URL syntax.<br>
    Clarify that null format ID unicast responses only need version number.<br>
    Add format id for net.jini.discovery.x500.SHA1withRSA format.<br>
    Miscellaneous edits.
</td>
  </tr>
</table>




</h3>
<ul>
  <a href="#2831"><sup>1</sup></a>
<a name="41119"> </a>As used in this document, the terms "Java virtual machine" or "JVM" mean a virtual machine for the Java platform.<br>
<p>
<a href="#40286"><sup>2</sup></a>
<a name="40289"> </a>If you speak hexadecimal, you will notice that <code>4160</code> is the decimal representation of (<code>CAFE</code> - <code>BABE</code>).<br>
</ul>
</blockquote>
<h3 class="Heading2">
  <a name="0188"> </a>		 License	 
</h3>
<p>
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership. The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License. You may obtain a copy of the License at
<ul>
     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
</ul>
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</blockquote>

<hr>
<a href="#skip" title="Skip navigation bar"></a>
<table width="100%"><tr>
<td align=left><a href="../../spec-index.html">Spec Index</a>
</td><td align=right><em>Jini Technology Core Platform Specifications</em></td>
</tr></table>
<a name="skip"></a>

<hr>
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership. The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License. You may obtain a copy of the License at
<ul>
     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
</ul>
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

</body>
</html>

<!-- This HTML file was initially created with Quadralay WebWorks Publisher 3.5.0 -->
<!-- by Susan Snyder -->
<!-- Last updated: 01/25/05 -->
