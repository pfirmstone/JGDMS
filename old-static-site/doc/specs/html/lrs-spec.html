<!--
 ! Licensed to the Apache Software Foundation (ASF) under one
 ! or more contributor license agreements.  See the NOTICE file
 ! distributed with this work for additional information
 ! regarding copyright ownership. The ASF licenses this file
 ! to you under the Apache License, Version 2.0 (the
 ! "License"); you may not use this file except in compliance
 ! with the License. You may obtain a copy of the License at
 ! 
 !      http://www.apache.org/licenses/LICENSE-2.0
 ! 
 ! Unless required by applicable law or agreed to in writing, software
 ! distributed under the License is distributed on an "AS IS" BASIS,
 ! WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 ! See the License for the specific language governing permissions and
 ! limitations under the License.
 !-->

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="GENERATOR" content="Quadralay WebWorks Publisher 5.0.4">
<link rel="StyleSheet" href="standard.css" type="text/css" media="screen">
<title>Jini Lease Renewal Service Specification  </title>
</head>

<body bgcolor="#ffffff">


<a href="#skip" title="Skip navigation bar"></a>
<table width="100%">
<tr>
<td align=left><a href="../../spec-index.html">Spec Index</a></td>
<td align=right><em>A Collection of Jini Technology Helper Utilities and Services Specifications</em></td>
</tr>
</table>
<br clear="all">


<hr align="left">
<table width="90%">
<tr>
<td align="right" font size="4"><b>Version 1.0</b></td>
</tr>
</table>
<a name="skip"></a>
<blockquote>
<h2>
  <a name="1005695"> </a>LR - Jini<font size="-1"><sup>TM</sup></font> Lease Renewal Service Specification
</h2>
<h3 class="Heading2">
  <a name="1000045"> </a>LR.1	 Introduction
</h3>
<p class="Body">
  <a name="1006066"> </a>Leasing is a key concept in the Jini<font size="-1"><sup>TM</sup></font> architecture; in general, Jini technology-enabled services (<em class="Emphasis">Jini services</em>) grant access to a resource only for as long as the clients of those Jini services actively express interest in the resource being maintained. This pattern is in contrast to many other systems, in which access to a resource is granted until the client explicitly releases the resource. Using a leasing model generally makes a distributed system more robust by allowing stale information and services to be cleaned up, but it also places additional requirements on clients and services.
</p>
<p class="Body">
  <a name="1001371"> </a>A client of a leased service may run into difficulties if that client deactivates. Unless the client ensures that some other process renews the client's leases while it is inactive, or that the client is activated before its leases begin to expire, the client will lose access to the resources it has acquired. This loss can be particularly dramatic in the case of lookup service registrations. A service's registration with a lookup service is leased--if the service deactivates (maybe to conserve computational resources on its host) and it does not take appropriate steps, its registrations with lookup services will expire, and before long it will be inaccessible. If that service becomes active only when clients invoke its methods, it may never become active again, because at this point new clients may not be able to find it.
</p>
<p class="Body">
  <a name="1006118"> </a>The need to renew leases creates a constant load on clients, servers, and the network. Although batching lease renewals can help (see the <a href="lease-spec.html"><em class="Emphasis">Jini Distributed Leasing Specification</em></a>), a given client is unlikely to have very many leases granted by any one service at any given time, thus reducing the opportunities for meaningful batching.
</p>
<p class="Body">
  <a name="1002224"> </a>This additional load may be an especially great burden on clients that always have the ability to access the network but cannot be continuously connected. A cell phone always has the ability to connect; however, being connected all the time will drain its batteries and accumulate airtime charges. One or two leases may not pose a problem, but a large number of leases could force the phone to be on the network all the time.
</p>
<p class="Body">
  <a name="1002237"> </a>A lease renewal service can help mitigate these problems. Clients that wish to become inactive can pass the responsibility for renewing the leases they have been granted to a renewal service. Those clients can then deactivate without risk of losing access to the resources that they have acquired. Clients that have continuous access to the network but cannot be continuously connected, such as the cell phone described previously, can also register with a renewal service that can be continuously connected. The renewal service will renew the client's leases, allowing the client to remain disconnected most of the time. Lastly, if multiple clients pass their leases to a given renewal service, more opportunities for batching renewals will be created.
</p>
<p class="Body">
  <a name="1000205"> </a>Like other Jini services, the lease renewal service will grant its services for only a limited period of time without an active expression of continuing interest. To break the recursive cycle that would otherwise result, the renewal service provides an optional event that is triggered before the leases that it grants expire. This event gives activatable processes that have deactivated the opportunity to wake up and renew their lease with the renewal service. Although it may seem odd for the lease renewal service to lease its resources, it is very important that it does so. If it did not, then the lease renewal service could be used to subvert the leasing model.
</p>
<p class="Body">
  <a name="1010114"> </a>Lease renewal services are likely to grant longer leases than other Jini services. In some cases the lease may be so long that the client will not need to worry about renewing the lease at all. In other cases the lease may be long enough that a client that deactivates will rarely need to reactivate for the sole purpose of renewing its lease with the renewal service. In any case, the leases that the renewal service grants are likely to be sufficiently long such that the actual renewal calls do not place a significant additional load on the client, the renewal service, or the network.
</p>
<h4 class="Heading3">
  <a name="1000297"> </a>LR.1.1	  Goals and Requirements 
</h4>
<p class="Body">
  <a name="1000304"> </a>The requirements of the set of classes and interfaces in this specification are:
</p>
<ul>

  <li class="SmartList1"><a name="1000305"> </a>To provide a service for renewing leases<p>
  <li class="SmartList1"><a name="1000307"> </a>To provide this service in such a way that it can be used by activatable processes that deactivate<p>
  <li class="SmartList1"><a name="1000312"> </a>To provide this service in a way that does not overly weaken the leasing model
</ul>

<p class="Body">
  <a name="1000323"> </a>The goals of this specification are:
</p>
<ul>

  <li class="SmartList1"><a name="1000359"> </a>To describe the lease renewal service<p>
  <li class="SmartList1"><a name="1000360"> </a>To provide guidance in the use, deployment, and implementation of the lease renewal service
</ul>

<h4 class="Heading3">
  <a name="1000361"> </a>LR.1.2	 Other Types
</h4>
<p class="Body">
  <a name="1006404"> </a>The types defined in the specification of the <code>LeaseRenewalService</code> interface are in the <code>net.jini.lease</code> package. The following object types may be referenced in this chapter. Whenever referenced, these object types will be referenced in unqualified form:
</p>
<pre  class="Preformatted">
java.io.IOException
java.rmi.MarshalledObject
java.rmi.RemoteException
java.rmi.NoSuchObjectException
net.jini.core.lease.Lease
net.jini.core.lease.UnknownLeaseException
net.jini.core.event.RemoteEvent
net.jini.core.event.RemoteEventListener
net.jini.core.event.EventRegistration
</pre>
<h3 class="Heading2">
  <a name="1001235"> </a>LR.2	 The Interface
</h3>
<p class="Body">
  <a name="1011893"> </a>The <code>LeaseRenewalService</code> (in the <code>net.jini.lease</code> package) defines the interface to the renewal service. The interface is not a remote interface; each implementation of the renewal service exports proxy objects that implement the <code>LeaseRenewalService</code> interface local to the client, using an implementation-specific protocol to communicate with the actual remote server. All of the proxy methods obey normal Java(TM) Remote Method Invocation (Java RMI) remote interface semantics. Two proxy objects are equal (using the <code>equals</code> method) if they are proxies for the same renewal service. All the methods of <code>LeaseRenewalService</code> throw <code>RemoteException</code> and require only the default serialization semantics. Therefore, <code>LeaseRenewalService</code> can be implemented directly using Java RMI.
</p>
<pre  class="Preformatted">
package net.jini.lease;

public interface LeaseRenewalService {
    public LeaseRenewalSet createLeaseRenewalSet(
            long leaseDuration) 
        throws RemoteException;
}
</pre>
<p class="Body">
  <a name="1000478"> </a>Clients of the renewal service organize the leases they wish to have renewed into <em class="Emphasis">lease renewal sets</em> (or <em class="Emphasis">sets,</em> for short). A method is provided by the <code>LeaseRenewalService</code> interface to create these sets. These sets are then populated by methods on the sets themselves. Two leases in the same set need not be granted by the same service or have the same expiration time; in addition, they can be added or removed from the set independently.
</p>
<p class="Body">
  <a name="1010728"> </a>Every method invocation on a renewal service (whether the invocation is directly on the service or indirectly on a <code>set</code> the service has created) is atomic with respect other invocations.
</p>
<p class="Body">
  <a name="1006811"> </a>The term <em class="Emphasis">client lease</em> is used to refer to a lease that has been placed into a renewal set. Client leases are distinct from the leases that the renewal service grants on renewal sets it has created.
</p>
<p class="Body">
  <a name="1011925"> </a>In general, there will be times when an implementation of the renewal service needs to pass one client lease as an argument to a method call on a second client lease. There is a security risk in doing so, because such actions can let the second client lease "capture" the first.Implementations may want to verify that their clients can be trusted not to place leases in the set that would take such actions, or may choose to avoid passing client leases to each other if the leases are contained in different sets.</p>
<p class="Body">
  <a name="1010566"> </a>Each client lease has two expiration related times associated with it: the <em class="Emphasis">desired expiration</em> time for the lease and the <em class="Emphasis">actual expiration</em> time granted when the lease is created or last renewed. The desired expiration represents when the client would like the lease to expire. The actual expiration represents when the lease is going to expire if it is not renewed. Both time values are absolute times, not relative time durations. When a client lease's desired expiration arrives, the lease will be removed from the set without further client intervention. 
</p>
<p class="Body">
  <a name="1011315"> </a>Each client lease also has two other associated attributes: a <em class="Emphasis">renewal duration </em>and a <em class="Emphasis">remaining desired duration</em>. The remaining desired duration is always the desired expiration less the current time. The renewal duration is usually a positive number and represents the duration that will be requested when the renewal service renews the client lease, unless the renewal duration is greater than the remaining desired duration. If the renewal duration is greater than the remaining desired duration, then the remaining desired duration will be requested when renewing the client lease. One exception is that when the desired expiration is <code>Lease.FOREVER</code>, the renewal duration may be <code>Lease.ANY</code>, in which case <code>Lease.ANY</code> will be requested when renewing the client lease, regardless of the value of the remaining desired duration.
</p>
<p class="Body">
  <a name="1011325"> </a>For example, if the renewal duration associated with a given client lease is 360,000 milliseconds, then when the renewal service renews the client lease, it will ask for a new duration of 360,000 milliseconds--unless the client lease is going to reach its desired expiration in less than 360,000 milliseconds. If the client lease's desired expiration is within 360,000 milliseconds, the renewal service will ask for the difference between the current time and the desired expiration. If the renewal duration had been <code>Lease.ANY</code>, the renewal service would have asked for a new duration of <code>Lease.ANY</code>.
</p>
<p class="Body">
  <a name="1011239"> </a>If a lease's actual expiration is later than the lease's desired expiration, the renewal service will not renew the lease; the lease will remain in the set until its desired expiration is reached, the set is destroyed, or it is removed by the client.
</p>
<p class="Body">
  <a name="1011330"> </a>Each set is leased from the renewal service. If the lease on a set expires or is cancelled, the renewal service will destroy the set and take no further action with regard to the client leases in the set. Each lease renewal set has associated with it an expiration warning event that occurs at a client-specified time before the lease <em class="Emphasis">on the set</em> expires. Clients can register for warning events using methods provided by the set. A registration for warning events does not have its own lease, but instead is covered by the same lease under which the set was granted.
</p>
<p class="Body">
  <a name="1011735"> </a>The term <em>definite exception</em> is used to refer to an exception that could be thrown by an operation (such as a remote method call) on an object, for example a client lease, that would be indicative of a permanent failure of that object. The term <em>indefinite exception</em> refers to exceptions that would not imply anything about the probability of success of any future operations on the object. The algorithm used to classify exceptions as definite or indefinite is implementation-specific.</p>
<p class="Body">
  <a name="1011736"> </a>Each lease renewal set has associated with it a renewal failure event that will occur in either of two cases: if any client lease in the set reaches its actual expiration before its desired expiration is reached, or if the renewal service attempts to renew a client lease and gets a definite exception. Clients can register for failure events using methods provided by the set. A registration for failure events does not have its own lease but instead is covered by the same lease under which the set was granted.
</p>
<p class="Body">
  <a name="1012324"> </a>Once placed in a set, a client lease will stay there until one or more of the following occurs:
</p>
<ul>

  <li class="SmartList1"><a name="1012321"> </a>The lease on the set itself expires or is cancelled, causing destruction of the set.<p>
  <li class="SmartList1"><a name="1000503"> </a>The client lease is removed by the client.<p>
  <li class="SmartList1"><a name="1011141"> </a>The client lease's desired expiration is reached.<p>
  <li class="SmartList1"><a name="1011142"> </a>The client lease's actual expiration is reached; this will generate a renewal failure event.<p>
  <li class="SmartList1"><a name="1011143"> </a>A renewal attempt on the client lease results in a definite exception; this will generate a renewal failure event.
</ul>

<p class="Body">
  <a name="1000514"> </a>Each client lease in a set will be renewed as long as it is in the set. If a renewal call throws an indefinite exception, the renewal service should retry the lease renewal until the lease would otherwise be removed from the set. The preferred method of cancelling a client lease is for the client to first remove the lease from the set and then call <code>cancel</code> on it. It is also permissible for the client to cancel the lease without first removing the lease from the set, although this is likely to result in additional network traffic.
</p>
<p class="Body">
  <a name="1000593"> </a>The client creates a set by calling the <code>createLeaseRenewalSet</code> method of a <code>LeaseRenewalService</code>. The <code>leaseDuration</code> argument specifies how long (in milliseconds) the client wants the set's initial lease duration to be. The duration initially granted for the set's lease will be equal to or shorter than this request; it will not be longer. The value of the <code>leaseDuration</code> argument must be positive, <code>Lease.FOREVER</code>, or <code>Lease.ANY</code>; otherwise, an <code>IllegalArgumentException</code> will be thrown. Two calls to the <code>createLeaseRenewalSet</code> method will never return objects that are equal. The set's lease is obtained through a method provided by the set.
</p>
<p class="Body">
  <a name="1000634"> </a><code>LeaseRenewalSet</code> defines the interface to the sets created by the lease renewal service. This interface is not a remote interface. Each implementation of the renewal service exports proxy objects that implement the <code>LeaseRenewalSet</code> interface local to the client and use an implementation-specific protocol to communicate with the actual remote server. All of the proxy methods obey normal Java RMI remote interface semantics except where explicitly noted. The proxy objects for two sets are equal (using the <code>equals</code> method) if they are proxies for the same set created by the same renewal service. Any method that communicates with the remote server should throw a <code>NoSuchObjectException</code> if the set no longer exists. If a client receives a <code>NoSuchObjectException</code> from one of the operations on a lease renewal set, the client can infer that the set has been destroyed; however, it should <em class="Emphasis">not</em> infer that the renewal service has been destroyed.
</p>
<pre  class="Preformatted">
package net.jini.lease;

public interface LeaseRenewalSet {
    final public static long RENEWAL_FAILURE_EVENT_ID = 0;
    final public static long EXPIRATION_WARNING_EVENT_ID = 1;

    public void renewFor(Lease leaseToRenew,
                     long  desiredDuration,	 
                     long  renewDuration)
        throws RemoteException;

    public void renewFor(Lease leaseToRenew, 
                         long  desiredDuration)
        throws RemoteException;
    
    public EventRegistration setExpirationWarningListener(
            RemoteEventListener listener, 
            long                minWarning, 
            MarshalledObject    handback)
        throws RemoteException;

    public void clearExpirationWarningListener()
        throws RemoteException;

    public EventRegistration setRenewalFailureListener(
            RemoteEventListener listener, 
            MarshalledObject    handback)
        throws RemoteException;

    public void clearRenewalFailureListener()
        throws RemoteException;

    public Lease remove(Lease leaseToRemove) 
        throws RemoteException;
   
    public Lease[] getLeases() 
        throws LeaseUnmarshalException, RemoteException;

    public Lease getRenewalSetLease();
}
</pre>
<p class="Body">
  <a name="1000636"> </a>Leases can be added to the set through the <code>renewFor</code> methods. There are two forms of this method: a three-argument form and a two-argument form. The three-argument form will be described first. The <code>leaseToRenew</code> argument specifies the lease to be renewed. An <code>IllegalArgumentException</code> will be thrown if the lease has not expired and was granted by the renewal service itself. If <code>leaseToRenew</code> is <code>null</code>, a <code>NullPointerException</code> will be thrown.
</p>
<p class="Body">
  <a name="1002945"> </a>The <code>desiredDuration</code> parameter is the number of milliseconds that the client would like for the client lease to remain in the set. It is used to calculate the client lease's desired expiration by adding <code>desiredDuration</code> to the current time (as viewed by the service). If this causes an overflow, a desired expiration of <code>Long.MAX_VALUE</code> will be used. Unlike a lease duration, the desired duration is unilaterally specified by the client, not negotiated between the client and the service. Note that a negative value for <code>desiredDuration</code> (including <code>Lease.ANY</code>) will result in a desired expiration that is in the past. This will cause the client lease to be dropped immediately from the set and will not result in an exception. A renewal failure event will be generated if and only if the client's actual expiration is before its desired expiration.
</p>
<p class="Body">
  <a name="1010620"> </a>If the actual expiration time of the client lease being added to the set is before both the current time (as viewed by the renewal service) and the client lease's desired expiration time, the method will return normally. However, the client lease will be dropped from the set, and a renewal failure event will be generated. If the actual expiration time is before the current time and equal to or after the desired expiration time, the method will return normally, the client lease will be dropped from the set, and no event will be generated.
</p>
<p class="Body">
  <a name="1001980"> </a>A <code>desiredDuration</code> of <code>Long.MAX_VALUE</code> does not imply that the client lease will remain in the set forever. The client lease will be ejected from the set if the set is destroyed, the client lease itself expires, the client lease is removed from the set, or the renewal service makes a renewal attempt on the client lease that results in a definite exception.
</p>
<p class="Body">
  <a name="1010388"> </a>The <code>renewDuration</code> is the renewal duration to associate with the client lease (in milliseconds). If <code>desiredDuration</code> is exactly <code>Long.MAX_VALUE</code>, the <code>renewDuration</code> may be any positive number or <code>Lease.ANY</code>; otherwise it must be a positive number. If these requirements are not met, the renewal service will throw an <code>IllegalArgumentException</code>.
</p>
<p class="Body">
  <a name="1010386"> </a>Calling <code>renewFor</code> with a lease that is equivalent to a client lease already in the set will associate the existing client lease in the set with the new desired duration and renew duration. The original copy of the client lease is not replaced with the new one. These semantics also allow <code>renewFor</code> to be used in an idempotent fashion.
</p>
<p class="Body">
  <a name="1010398"> </a>The two-argument form of <code>renewFor</code> is equivalent to
</p>
<pre  class="Preformatted">
renewFor(leaseToRenew, desiredDuration, Lease.FOREVER)
</code></pre>
<p class="Body">
  <a name="1011085"> </a>Client leases get returned to clients in a number of ways (via <code>remove</code> and <code>getLeases</code> calls, as components of events, etc.). The serial format of client leases returned to clients may be either <code>Lease.DURATION</code> or <code>Lease.ABSOLUTE</code>. In particular it may be necessary to use the <code>Lease.ABSOLUTE</code> format if the implementation has access to the client lease only in marshalled form and is unable to unmarshal the client lease before sending it to the client.
</p>
<p class="Body">
  <a name="1011947"> </a>Whenever a client lease gets returned to a client, its actual expiration should reflect either:
</p>
<ul>

  <li class="SmartList1"><a name="1011948"> </a>The result of the last recorded successful renewal of the client lease performed by the renewal service; or<p>
  <li class="SmartList1"><a name="1010528"> </a>The expiration time the client lease originally had when it was added to the set, if the renewal service has been unable to successfully renew the client lease and record the result
</ul>

<p class="Body">
  <a name="1006810"> </a>Although it is impossible for a renewal service to guarantee that all renewal attempts will be recorded, persistent implementations should attempt to keep the interval between the renewal of a client lease and the logging of the result to a minimum.
</p>
<p class="Body">
  <a name="1011276"> </a>Client leases are removed from the set by using the <code>remove</code> method. Removal from the set will not cause the lease to be cancelled. The method will return the lease that is being removed. If the lease is not in the set, <code>null</code> will be returned; and this call will not be blocked by in-progress renewal attempts. As a result, a client lease removed by this method might be renewed after the method has returned. Implementations should keep the window where renewals of removed leases could occur as small as possible.
</p>
<p class="Body">
  <a name="1007318"> </a>The <code>getLeases</code> method returns all the client leases in the set at the time of the call, as an array of type <code>Lease</code>. If one or more of the <code>Lease</code>s in the array cannot be deserialized, a <code>LeaseUnmarshalException</code> is thrown.
</p>
<pre  class="Preformatted">
package net.jini.lease;

public class LeaseUnmarshalException extends Exception {
    public LeaseUnmarshalException(
            Lease[]            leases,
            MarshalledObject[] marshalledLeases,
            Throwable[]        exceptions) {...}
    public LeaseUnmarshalException(
            Lease[]            leases,
            MarshalledObject[] marshalledLeases,
            Throwable[]        exceptions,
            String             message) {...}

    public Lease[] getLeases() {...}
    public MarshalledObject[] getMarshalledLeases() {...}
    public Throwable[] getExceptions() {...}
}
</pre>
<p class="Body">
  <a name="1006801"> </a>The leases that could be successfully deserialized will be returned by the <code>getLeases</code> method of the exception. If no leases could be deserialized, a zero-length array will be returned. The leases that could not be deserialized will be returned in the form of <code>MarshalledObject</code>s by the <code>getMarshalledLeases</code> method of the exception. For each element of the array returned by the <code>getMarshalledLeases</code> method, the corresponding element of the array returned by the <code>getExceptions</code> method will hold a <code>Throwable</code> that indicates why the given lease could not be deserialized.
</p>
<p class="Body">
  <a name="1010402"> </a>Throwing a <code>LeaseUnmarshalException</code> represents a (possibly transient) failure in the ability to unmarshal one or more client leases in the set; it does not necessarily imply anything about the state of the renewal service or the set that threw the exception.
</p>
<p class="Body">
  <a name="1006782"> </a>The <code>getRenewalSetLease</code> method of <code>LeaseSet</code> returns the lease associated with the set itself. This method does not make a remote call.
</p>
<h4 class="Heading3">
  <a name="1006552"> </a>LR.2.1	 Events
</h4>
<p class="Body">
  <a name="1006553"> </a>The lease renewal service does not support multiple simultaneous event listener registrations for the same kind of event. Although it would be useful in some limited circumstances, to do so would require event registrations to be leased separately from the set they are associated with. For the average client of the lease renewal service, this ability would increase the number of leases that it would have to manage. Since the renewal service is based on the premise that some clients have difficulty managing their own leases, increasing the number of leases that a client would need to manage could significantly complicate the implementation of those clients. Because there can be at most one listener for each kind of event, a given set provides a <code>set/clear</code> interface instead of the more common <code>addListener/removeListener</code> or <code>addListener/lease.cancel</code> interfaces.
</p>
<p class="Body">
  <a name="1011984"> </a>The source field of each event generated by a lease renewal service is the renewal set that the event is associated with. In the case of an expiration warning event, this is the set that is about to expire. In the case of a renewal failure event, this is the set the client lease was in when the event occurred. Note that the value of the source field will in general be a copy of the set in question, the <code>equals</code> method will return <code>true</code> for any other copies of the set the client has in its possession, but in general it will not be the same object (that is, comparing two sets using <code>==</code> will usually return <code>false</code>).
</p>
<p class="Body">
  <a name="1011985"> </a>The event ID <code>LeaseRenewalSet.EXPIRATION_WARNING_EVENT_ID</code> is used for all expiration warning events. One event ID is used because there is only one kind of expiration warning event. Similarly, all renewal failure events will have the event ID <code>LeaseRenewalSet.RENEWAL_FAILURE_EVENT_ID</code>.
</p>
<p class="Body">
  <a name="1011679"> </a>Because all of the expiration warning events generated by a given set will have the same source and event ID, the sequence number of any given expiration warning event generated by the set will be different from the sequence number of any other expiration warning event generated by the set. Similarly, the sequence number of any renewal failure event generated by a given set will be different from the sequence number of any other renewal failure event generated by the set. Two different events with the same source and event ID will have different sequence numbers even if different event registration were in effect when each event was generated.
</p>
<p class="Body">
  <a name="1007437"> </a>If a <code>RemoteEventListener</code> registered for a renewal failure or expiration warning event throws an <code>UnknownEventException</code>, this action will only clear the specific event registration. It will not cancel the lease on the renewal set or affect any other event registration on the set. If the listener throws a definite exception, the renewal service may clear that specific event registration; it will not clear any registration associated with other listeners, nor will it cancel the lease on the associated renewal set.
</p>
<p class="Body">
  <a name="1006698"> </a>If an event listener is replaced and one or more event delivery attempts on the original listener failed, implementations may choose to send some or all of these events to the new listener.
</p>
<p class="Body">
  <a name="1011713"> </a>Event listeners may receive notification of events that they are no longer registered to receive, if those events occurred before they were unregistered. Implementations should keep the window where such notifications could occur as small as possible.
</p>
<p class="Body">
  <a name="1011714"> </a>The <code>setExpirationWarningListener</code> method of <code>LeaseRenewalSet</code> allows the client to register for notification of the approaching expiration of the <em class="Emphasis">set's </em>lease. Expiration warning events are not generated for client leases. The <code>listener</code> argument specifies which listener should be notified when the set's lease is about to expire. The <code>minWarning</code> argument specifies the minimum number of milliseconds before set lease expiration that the first event delivery attempt should be made by the service. The service may also make subsequent delivery attempts if the first and any subsequent attempts resulted in an indefinite exception. The <code>minWarning</code> argument must be zero or a positive number; if it is not, an <code>IllegalArgumentException</code> must be thrown. If the current expiration of the set's lease is less than <code>minWarning</code> milliseconds away, the event will occur immediately (though it will take time to propagate to the handler).
</p>
<p class="Body">
  <a name="1002363"> </a>The <code>handback</code> argument to <code>setExpirationWarningListener</code> specifies an object that will be part of the expiration warning event notification. This mechanism is detailed in the <a href="event-spec.html"><em class="Emphasis">Jini Distributed Events Specification</em></a>.
</p>
<p class="Body">
  <a name="1012046"> </a>The <code>setExpirationWarningListener</code> method returns the event registration for this event. The <code>Lease</code> object associated with the registration will be equivalent (in the sense of the <code>equals</code> method) to the <code>Lease</code> on the renewal set. Because the event registration shares a lease with the set, clients that want to just remove their expiration warning registration without destroying the set should use the <code>clearExpirationWarningListener</code> method described below, instead of cancelling the registration's lease. The event ID returned with the registration will be <code>LeaseRenewalSet.EXPIRATION_WARNING_EVENT_ID</code>. The source of the registration will be the set. The method will throw a <code>NullPointerException</code> if the <code>listener</code> argument is <code>null</code>. If an event handler has already been specified for this event, the current registration is replaced with the new one. Because both registrations are for the same kind of event, the events sent to the new registration must be in the same sequence as the events sent to the old registration.
</p>
<p class="Body">
  <a name="1001577"> </a>The <code>clearExpirationWarningListener</code> method of <code>LeaseRenewalSet</code> removes the event registration currently associated with the approaching expiration of the set's lease. It is acceptable to call this method even if there is no active registration.
</p>
<p class="Body">
  <a name="1001640"> </a>The <code>setRenewalFailureListener</code> method of <code>LeaseRenewalSet</code> allows the client to register for the event associated with the failure to renew a client lease in the set. These events are generated when a client lease in the set reaches its actual expiration before its desired expiration or when the service attempts to renew a client lease and gets a definite exception. The <code>listener</code> argument specifies the listener to be notified if a client lease could not be renewed. 
</p>
<p class="Body">
  <a name="1001621"> </a>The <code>handback</code> argument to <code>setRenewalFailureListener</code> specifies an object that will be part of the renewal failure event notification. This mechanism is detailed in the <a href="event-spec.html"><em class="Emphasis">Jini Distributed Events Specification</em></a>.
</p>
<p class="Body">
  <a name="1012121"> </a>The <code>setRenewalFailureListener</code> method returns the event registration for this event. The <code>Lease</code> object associated with the registration will be equivalent (in the sense of the <code>equals</code> method) to the <code>Lease</code> on the renewal set. Because the event registration shares a lease with the set, clients that want to just remove their expiration warning registration without destroying the set should use the <code>clearRenewalFailureListener</code> method (described below) instead of cancelling the registration's lease. The registration ID returned with the registration will be <code>LeaseRenewalSet.RENEWAL_FAILURE_EVENT_ID</code>. The source of the registration will be the set. The method will throw <code>NullPointerException</code> if the <code>listener</code> argument is <code>null</code>. If an event handler has already been specified for this event, the current registration is replaced with the new one. Because both registrations are for the same kind of event, the events sent to the new registration must be in the same sequence as the events sent to the old registration.
</p>
<p class="Body">
  <a name="1001624"> </a>The <code>clearRenewalFailureListener</code> method of <code>LeaseRenewalSet</code> removes the event registration currently associated with the failure to renew client leases. It is acceptable to call this method even if there is no active registration.
</p>
<pre  class="Preformatted">
package net.jini.lease;

public class ExpirationWarningEvent extends RemoteEvent {
    public ExpirationWarningEvent(
            LeaseRenewalSet  source,
            long             seqNum,
            MarshalledObject handback) {...}
    public Lease getRenewalSetLease() {...}
<code>}
</code></pre>
<p class="Body">
  <a name="1012140"> </a><code>ExpirationWarningEvent</code> objects are passed to the event handlers specified in calls to the <code>LeaseRenewalSet</code> method, <code>setExpirationWarningListener</code>. The <code>ExpirationWarningEvent</code> is a subclass of <code>RemoteEvent</code> and adds no additional state. Because the source of a <code>ExpirationWarningEvent</code> is the set that is about to expire, the lease that needs to be renewed can be obtained by: calling <code>getSource</code>, casting the result to a <code>LeaseRenewalSet</code> and then invoking the set's <code>getRenewalSetLease</code> method. The convenience method <code>getRenewalSetLease</code> in <code>ExpirationWarningEvent</code> uses  this technique to retrieve the lease on the set.  The <code>Lease</code> object returned will be equivalent (in the sense of the <code>equals</code> method) to other <code>Lease</code> objects associated with the set but may not be the same object. One notable consequence of having two different objects is that the <code>getExpiration</code> method of the <code>Lease</code> object returned by the event's <code>getRenewalSetLease</code> method may return a different time than the <code>getExpiration</code> methods of other <code>Lease</code> objects granted on the same set.
</p>
<p class="Body">
  <a name="1010427"> </a>The expiration time associated with the <code>Lease</code> object returned by the <code>getRenewalSetLease</code> method will reflect the expiration the lease had when the event occurred. Renewal calls may have changed the expiration time of the underlying lease between the time when the event was generated and when it was delivered. 
</p>
<p class="Body">
  <a name="1010431"> </a>Other aspects of the event's state are described in the <a href="event-spec.html"><em class="Emphasis">Jini Distributed Events Specification</em></a>. Sequence numbers for a given event ID are increasing. If there is no gap between two sequence numbers, no events have been missed; if there is a gap, events might (but might not) have been missed.
</p>
<pre  class="Preformatted">
package net.jini.lease;

public abstract class RenewalFailureEvent
    extends RemoteEvent
{
    public RenewalFailureEvent(LeaseRenewalSet  source,
                               long             seqNum,
                               MarshalledObject handback) {...}
    abstract public Lease getLease() 
        throws IOException, ClassNotFoundException;
    abstract public Throwable getThrowable()
        throws IOException, ClassNotFoundException;
}
</pre>
<p class="Body">
  <a name="1011660"> </a><code>RenewalFailureEvent</code> objects are passed to the event handlers specified in calls to the <code>LeaseRenewalSet</code> method, <code>setRenewalFailureListener</code>. The <code>RenewalFailureEvent</code> is a subclass of <code>RemoteEvent</code>, adding two additional items of abstract state: the client lease that could not be renewed before expiration and the <code>Throwable</code> object that was thrown by the last recorded renewal attempt (if any). The client lease is returned by the <code>getLease</code> method, and the <code>Throwable</code> object is returned by the <code>getThrowable</code> method. If the <code>Throwable</code> object is <code>null</code>, it can be assumed that during the time between the last-recorded, successful renewal (or when the client lease was added to the set if there have been no renewals) and the actual expiration time of the client lease the renewal service was either unable to attempt a renewal of the client lease, or that it attempted a renewal but was unable to record the result.
</p>
<p class="Body">
  <a name="1006443"> </a>Both the <code>getLease</code> and <code>getThrowable</code> methods may throw <code>IOException</code> or <code>ClassNotFoundException</code>. This declaration allows implementations to delay unmarshalling this state until it is actually needed. Once either method of a given <code>RenewalFailureEvent</code> object returns normally, future calls on that method must return the same object and may not throw an exception. 
</p>
<p class="Body">
  <a name="1001917"> </a>If the renewal service was able to renew the client lease and record the result before the event occurred, the expiration time of the <code>Lease</code> object returned by the event's <code>getLease</code> method will reflect the result of the last-recorded successful renewal call. Note that this time may be distorted by clock skew between hosts if it is currently set to use the <code>Lease.ABSOLUTE</code> serial format. If the <code>Lease</code> object is using the <code>Lease.DURATION</code> serial format, and the event only unmarshals the lease when <code>getLease</code> is called, the expiration time may be distorted if a long time has passed between the time the event was generated by the renewal service and when the client called <code>getLease</code>. When a renewal failure event is generated for a given lease, that lease is removed from the set.
</p>
<p class="Body">
  <a name="1011496"> </a>The event's other state is described in the <a href="event-spec.html"><em class="Emphasis">Jini Distributed Events Specification</em></a>.
 Sequence numbers for a given event ID are increasing. If there is no gap between two sequence numbers, no events have been missed; if there is a gap, events might (but might not) have been missed.
</p>
<h4 class="Heading3">
  <a name="1011531"> </a>LR.2.2	 Serialized Forms
<p><CENTER>
<table border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000"
       cellpadding="5" cellspacing="0" summary="serialized forms of the following classes">
  <caption></caption>
  <tr bgcolor="#CCCCCC">
    <th>Class<br></th>
    <th>serialVersionUID<br></th>
    <th>Serialized Fields<br></th>
  </tr>
  <tr>
    <td><code>RenewalFailureEvent</code><br></td>
    <td>889145704195932943L<br></td>
    <td><em>none</em><br></td>
  </tr>
  <tr>
    <td><code>ExpirationWarningEvent</code><br></td>
    <td>-2020487536756927350L<br></td>
  <td><em>none</em><br></td>
  </tr>
  <tr>
    <td><code>LeaseUnmarshalException</code><br></td>
    <td>-6736107321698417489L<br></td>
    <td><code>Lease[]unmarshalledLeases</code><br>
	<code>MarshalledObject[]</code><br>
        <code>stillMarshalledLeases</code><br>
	<code>Throwable[] exceptions</code><br></td>
  </tr>
</table>
</CENTER>
<h3 class="Heading2">
  <a name="43987"> </a>LR.3	 History</h3>
<p>
<table align="center" border="1" bordercolorlight="#FFFFFF" bordercolordark="#000000" cellpadding="5" cellspacing="0" summary="history of this specification">
  <caption><p class="Body">
  <a name="01887"> </a>
</p>
</caption>
  <tr bgcolor="#CCCCCC">
    <th>Version</th>
    <th>Description</th>
  </tr>
 <tr>
    <td valign="top">v1.0
	</td>
    <td>Initial release of this specification.
</td>
  </tr>
</table>

<h3 class="Heading2">
  <a name="0188"> </a>		 License	 
</h3>
<p>
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership. The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License. You may obtain a copy of the License at
<ul>
     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
</ul>
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
</blockquote>

<hr>
<a href="#skip" title="Skip navigation bar"></a>
<table width="100%"><tr>
<td align=left><a href="../../spec-index.html">Spec Index</a>
<td align=right><em>A Collection of Jini Technology Helper Utilities and Services Specifications</em></td>
</tr></table>
<a name="skip"></a>

<hr>
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership. The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License. You may obtain a copy of the License at
<ul>
     <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>
</ul>
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

</body>
</html>

<!-- This HTML file was initially created with Quadralay WebWorks Publisher 3.5.0 -->
<!-- by Susan Snyder -->
<!-- Last updated: 01/27/05 -->

